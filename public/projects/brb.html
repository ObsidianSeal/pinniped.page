<!DOCTYPE html>

<html lang="en">
	<head>
		<title>Bus Ride Bingo</title>

		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="theme-color" content="#4ecdc4" />

		<link rel="icon" href="../images/icon.png" />

		<script src="https://kit.fontawesome.com/c6ef7d4818.js" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>

		<meta property="og:url" content="https://pinniped.page/projects/brb" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="Bus Ride Bingo" />
		<meta property="og:description" content="Play bus-related bingo with friends while on the bus." />
		<meta property="og:image" content="https://pinniped.page/images/icon.png" />

		<meta name="description" content="Play bus-related bingo with friends while on the bus." />
		<meta name="keywords" content="pinniped.page, obsidian_seal, bus, bingo, game, transit, friends, fun" />

		<style>
			/* TYPE */

			@import url("https://fonts.googleapis.com/css2?family=Dosis:wght@200..800");

			/* GENERAL STYLES */

			body {
				margin: 0;
				border: 0;
				padding: 0;

				font-family: "Dosis", "Roboto", sans-serif;
				font-style: normal;
				font-weight: 400;
				font-size: 20px;
			}

			b {
				font-weight: 700;
			}

			b:not(li b, span b, b.button, .stat b) {
				font-size: 30px;
			}

			ul {
				margin: 0;
			}

			li::marker {
				color: grey;
			}

			a {
				color: black;

				text-decoration-line: underline;
				text-decoration-style: dashed;
				text-decoration-color: grey;
				text-decoration-skip-ink: none;
			}

			a:hover,
			a:focus {
				text-decoration-color: deeppink;
			}

			/* SPECIFIC STYLES */

			.board-container {
				display: flex;
				justify-content: center;

				user-select: none;
				-ms-user-select: none;
				-moz-user-select: none;
				-webkit-user-select: none;

				-webkit-tap-highlight-color: transparent;

				touch-action: manipulation;
			}

			.board {
				max-width: 754px;

				display: grid;
				grid-template-columns: repeat(5, 20%);
				grid-template-rows: repeat(5, 20%);

				margin: 50px;
				border: 2px solid black;

				background-color: black;
			}

			.square {
				display: flex;
				align-items: center;
				justify-content: center;

				aspect-ratio: 1;
				overflow: hidden;

				border: 2px solid black;
				padding: 10px;

				font-size: 40px;
				text-align: center;
				text-wrap-mode: wrap;
				text-wrap-style: pretty;

				background-color: white;
			}

			.square:hover {
				cursor: pointer;
			}

			.square.filled {
				background-color: yellowgreen;
			}

			.square-emoji {
				font-size: 200%;
			}

			.text {
				margin: 50px;
				max-width: 850px;
			}

			.text b.button {
				background-color: black;
				color: white;

				user-select: none;
				-ms-user-select: none;
				-moz-user-select: none;
				-webkit-user-select: none;

				-webkit-tap-highlight-color: transparent;
			}

			.text b.button:hover {
				cursor: pointer;
			}

			.stats {
				box-sizing: border-box;

				width: 100%;

				padding: 50px;

				background-color: lightgrey;
			}

			.stats > div:not(:last-child) {
				margin-bottom: 50px;
			}

			.stat {
				position: relative;

				height: 30px;

				background-color: white;
			}

			.stat div {
				overflow-x: scroll;
				overflow-y: hidden;
				white-space: nowrap;

				height: 30px;

				display: flex;
				align-items: center;

				position: absolute;

				padding: 0 5px;

				box-sizing: border-box;
				width: calc(100dvw - 100px);
			}

			.stat div::-webkit-scrollbar {
				height: 0;
			}

			.stat:not(:last-child) {
				margin-bottom: 5px;
			}

			/* CONDITIONAL STYLES */

			@media all and (max-width: 800px) {
				.board {
					margin: 10px;
				}
			}

			@media all and (max-width: 600px) {
				.board {
					border-width: 1px;
				}

				.square {
					border-width: 1px;
					padding: 2px;
				}
			}

			@media all and (max-width: 500px) {
				.text {
					margin: 50px 20px;
				}
				.stats {
					padding: 50px 20px;
				}
				.stat div {
					width: calc(100dvw - 40px);
				}
			}

			@media all and (prefers-reduced-motion: reduce) {
				canvas {
					display: none;
				}
			}
			@media all and (prefers-reduced-motion) {
				canvas {
					display: none;
				}
			}

			@media print {
				* {
					display: none;
				}
			}

			/* ANIMATIONS */

			#d1,
			#d2,
			#d3 {
				opacity: 0%;
			}

			#d1 {
				animation: d1 2.5s infinite 0.5s;
			}

			#d2 {
				animation: d2 2.5s infinite 0.5s;
			}

			#d3 {
				animation: d3 2.5s infinite 0.5s;
			}

			@keyframes d1 {
				0% {
					opacity: 0%;
				}
				20% {
					opacity: 100%;
				}
				40% {
					opacity: 100%;
				}
				60% {
					opacity: 100%;
				}
				80% {
					opacity: 100%;
				}
				100% {
					opacity: 0%;
				}
			}

			@keyframes d2 {
				0% {
					opacity: 0%;
				}
				20% {
					opacity: 0%;
				}
				40% {
					opacity: 100%;
				}
				60% {
					opacity: 100%;
				}
				80% {
					opacity: 100%;
				}
				100% {
					opacity: 0%;
				}
			}

			@keyframes d3 {
				0% {
					opacity: 0%;
				}
				20% {
					opacity: 0%;
				}
				40% {
					opacity: 0%;
				}
				60% {
					opacity: 100%;
				}
				80% {
					opacity: 100%;
				}
				100% {
					opacity: 0%;
				}
			}
		</style>
	</head>

	<body>
		<div class="main-panel">
			<div class="board-container">
				<div class="board">
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
					<div class="square"><div class="inner-square"></div></div>
				</div>
			</div>
			<div class="text">
				<b class="button" id="submit" title="&gt; CLICK/TAP TO SUBMIT/SHARE BOARD & GENERATE ANOTHER &lt;"
					>&nbsp;&gt; CLICK/TAP TO SUBMIT/SHARE BOARD & GENERATE ANOTHER &lt;&nbsp;</b
				><br /><br />
				<b class="button" id="resize" title="&gt; CLICK/TAP TO AUTO-RESIZE BINGO BOARD TEXT &lt;">&nbsp;&gt; CLICK/TAP TO AUTO-RESIZE BINGO BOARD TEXT &lt;&nbsp;</b
				><br /><br />
				<b>Bus Ride Bingo</b>
				<ul>
					<li>24 of 60 possible events are randomly selected (plus the free square in the centre) and used to populate this 5-by-5 bingo card</li>
					<li>click or tap on a square to highlight it</li>
					<li>getting 5 in a row triggers confetti!</li>
					<li>
						when you&rsquo;re done, whether or not you won, please press the <b>&ldquo;CLICK/TAP TO SUBMIT/SHARE BOARD & GENERATE ANOTHER&rdquo;</b> button to log
						the events of your ride, copy the text representation of your board, and refresh the page
					</li>
				</ul>
				<br />
				<b>Purpose</b>
				<ul>
					<li>Make your bus rides more fun</li>
					<li>Become more observant while gaining an appreciation for bus operations, bus-related events, and your transit system as a whole</li>
					<li>Determine which events are the most and least likely to occur</li>
				</ul>
				<br />
				<b>Extras</b>
				<ul>
					<li>
						confetti is disabled for those who
						<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion" title="MDN > prefers-reduced-motion" target="_blank"
							>prefer reduced motion</a
						>
					</li>
					<li>confetti only appears after the first bingo</li>
					<li>reloading will generate a new board</li>
					<li>
						if you change the size of your window or your screen&rsquo;s orientation, press the
						<b>&ldquo;CLICK/TAP TO AUTO-RESIZE BINGO BOARD TEXT&rdquo;</b> button to automatically shrink the text in the bingo squares to fit
					</li>
					<li>scroll down for event statistics</li>
				</ul>
				<br />
				<b>Attribution</b>
				<ul>
					<li>confetti from <a href="https://confetti.js.org/more.html" title="tsParticles > More Examples" target="_blank">tsParticles</a></li>
					<li>
						typeset in
						<a href="https://fonts.google.com/specimen/Dosis?preview.text=hello%20from%20the%20pinniped.page" title="Google Fonts > Dosis" target="_blank"
							>Dosis</a
						>
					</li>
				</ul>
				<br />
				<b>Links</b>
				<ul>
					<li><a href="../projects+.html" title="pinniped.page ‚Äî Projects+">return to the Projects+ page</a></li>
					<li><a href="bus-data.html" title="BUS DATA">BUS DATA</a></li>
					<li><a href="../contact.html" title="pinniped.page ‚Äî Contact">report a problem or suggest a feature</a></li>
				</ul>
				<br />
				‚Äî<br />BRB v2.3.2 (June 18th, 2025)<br /><a href="" title="this page (click to refresh)">pinniped.page/projects/brb</a> by
				<a href="../about.html" title="pinniped.page ‚Äî About">Obsidian_Seal</a>
			</div>

			<div class="stats">
				<div class="events">
					<b>Event Statistics</b><br /><br />
					<b id="events-load">Loading<d id="d1">.</d><d id="d2">.</d><d id="d3">.</d></b>
				</div>
				<div class="games">
					<b>Game Statistics</b><br /><br />
					<b id="games-load">Loading<d id="d1">.</d><d id="d2">.</d><d id="d3">.</d><br /></b>
				</div>
			</div>
		</div>
	</body>

	<script type="module">
		"use strict";

		// IMPORT FIREBASE v11.9.1 (the latest version when this was written)
		import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
		import { getDatabase, ref, set, get, push, remove } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

		// CONFIGURE FIREBASE APP & DATABASE
		const firebaseConfig = {
			apiKey: "AIzaSyAigBAgn7Uhybip_m3P508DIpybb2qdI5g",
			authDomain: "the-pinniped-page.firebaseapp.com",
			databaseURL: "https://the-pinniped-page.firebaseio.com",
			projectId: "the-pinniped-page",
			storageBucket: "the-pinniped-page.appspot.com",
			messagingSenderId: "636989973689",
			appId: "1:636989973689:web:6d938d9588606d803a6768",
		};
		const app = initializeApp(firebaseConfig);

		// DEBUG STYLES
		const blueStyle = "background: #4ecdc4; color: black; padding: 0 5px";
		const yellowStyle = "background: #ffe66d; color: black; padding: 0 5px";
		const redStyle = "background: #ff6b6b; color: black; padding: 0 5px";
		const darkGreyStyle = "background: #949792; color: black; padding: 0 5px";
		const lightGreyStyle = "background: #d7d8cb; color: black; padding: 0 5px";

		// VERSION
		console.log(`%cBRB v2.3.2 (June 18th, 2025)`, darkGreyStyle);

		// ARRAY MIXING ALGORITHM
		function mixArray(array) {
			for (let i = 0; i < array.length; i++) {
				let randomIndex = Math.floor(Math.random() * (array.length - i)) + i;
				[array[i], array[randomIndex]] = [array[randomIndex], array[i]];
			}
			return array;
		}

		// EMOJI ISOLATING & SQUARE TEXT FORMATTING ALGORITHM
		function formatSquareText(string) {
			string =
				`<span>` +
				string.substring(0, string.lastIndexOf(" ")) +
				`</span><br /><span class="square-emoji">` +
				string.substring(string.lastIndexOf(" ") + 1) +
				`</span>`;
			return string;
		}

		// LIST OF ALL POSSIBLE BINGO BOARD SQUARES
		let squares = [
			"detour (or construction on route) üöß",
			"see or be on an articulated bus üöç",
			"near bus on the same route and direction üöé",
			"driver says something üë®‚Äçü¶∞",
			"front seats raised or lowered üìà",
			"wheelchair or similar is on the bus üë®‚Äçü¶º",
			"driver leaves bus ü¶∂",
			"honk! üîä",
			"someone&rsquo;s stop is missed üõë",
			"arrive at your stop (last chance for bingo!) üöè",
			"someone is standing (for more than one stop) üßç‚Äç‚ôÄÔ∏è",
			"go under a bridge (or through a tunnel) üöá",
			"go on a bridge üåâ",
			"stroller üë∂",
			"disruptive baby or young child üò≠",
			"someone gets on/off where people normally can&rsquo;t üë®‚Äçü¶Ø",
			"bus goes up onto the curb üòØ",
			"something falls on the floor üò¨",
			"sitting at a stop (no one getting on/off) ‚è≥",
			"someone is running for a bus! üèÉ‚Äç‚ôÄÔ∏è",
			"go over or under railroad tracks üöÜ",
			"see or be in a bus only lane! üöã",
			"pass a stop with a shelter üè†",
			"someone speaks in a language you don&rsquo;t üí¨",
			"skip a stop üö´",
			"unnecessary stop, accidental stop request, or cord/button/door doesn&rsquo;t work üö™",
			"pass a bus on the same route but opposite direction üîÄ",
			"5+ people board üö∂‚Äç‚ôÇÔ∏è",
			"5+ people get off üö∂‚Äç‚ôÄÔ∏è",
			"people at a stop are waiting for a different bus üñê",
			"driver waves at other bus driver üëã",
			"another bus is in the next lane (same direction) üõ¥",
			"someone is sitting next to you üòê",
			"see an express bus üöå",
			"travel on a road with 4+ lanes üß†",
			"travel on a one-way road ‚è©",
			"hear music üé∂",
			"someone&rsquo;s on the phone or talking loudly ü¶ú",
			"see a taxi or mail, garbage, or recycling truck üöï",
			"bike in the rack üö≤",
			"bus kneels üßé‚Äç‚ôÇÔ∏è",
			"see another bus driver or transit staff üë®‚Äç‚úàÔ∏è",
			"someone goes out the front door üë†",
			"see/pass a school üè´",
			"someone coughs or sneezes üôÅ",
			"see a non-transit bus (school, intercity, etc.) üéí",
			"see a city bus that isn&rsquo;t on a route üëÅ‚Äçüó®",
			"see an emergency vehicle üöë",
			"pass scanner difficulties üëæ",
			"someone tries too hard to open the rear door üò°",
			"someone gives up their seat ü™ë",
			"someone pays with coins ü™ô",
			"precipitation while on the bus üåßÔ∏è",
			"stop in a bus bay üõ£Ô∏è",
			"bus shakes violently or brakes harshly (significant turbulence) ü´®",
			"someone opens or closes a window ü™ü",
			"see/pass a library üìö",
			"bus driver is thanked ‚ù§Ô∏è",
			"transfer offered or accepted üé´",
			"someone uses a transfer üéüÔ∏è",
		];
		squares = mixArray(squares);
		console.log(`%c${squares.length}+1 possible squares`, lightGreyStyle);

		// PUT TEXT IN THE SQUARES
		window.addEventListener("load", () => {
			let squareIndex = 0;
			document.querySelectorAll(".inner-square").forEach((square) => {
				let text = squares[squareIndex].replace(/\&rsquo;/g, "‚Äô");
				if (squareIndex == 12) text = `bus moves (free space?) üëÄ`;
				square.innerHTML = formatSquareText(text);
				square.parentElement.title = text;

				square.id = `${Math.floor(squareIndex / 5)},${squareIndex % 5}`;

				square.parentElement.addEventListener("click", () => {
					square.parentElement.classList.toggle("filled");

					let indices = square.id.split(",");
					board[indices[0]][indices[1]] = !board[indices[0]][indices[1]];

					checkBingo(indices);
				});

				squareIndex++;
			});
			shrinkToFit();
		});

		// CONSTANT SIZES
		const BORDER_BIG = 2;
		const BORDER_SMALL = 1;
		const PADDING_BIG = 10;
		const PADDING_SMALL = 2;
		const MAXIMUM_FONT_SIZE = 40;

		// SHRINK TO FIT
		function shrinkToFit() {
			let sizeDifference = PADDING_BIG * 2 + BORDER_BIG * 2;
			if (window.innerWidth <= 600) sizeDifference = PADDING_SMALL * 2 + BORDER_SMALL * 2;

			document.querySelectorAll(".inner-square").forEach((square) => {
				let outerRect = square.parentElement.getBoundingClientRect();
				let innerRect = square.getBoundingClientRect();

				let fontSize = MAXIMUM_FONT_SIZE;
				do {
					square.style = `font-size: ${fontSize--}px`;

					outerRect = square.parentElement.getBoundingClientRect();
					innerRect = square.getBoundingClientRect();
				} while (innerRect.height > outerRect.height - sizeDifference);
			});
		}

		// DETECT BINGO, CONFETTI
		let board = [
			[false, false, false, false, false],
			[false, false, false, false, false],
			[false, false, false, false, false],
			[false, false, false, false, false],
			[false, false, false, false, false],
		];
		let bingo = false;
		function checkBingo(indices) {
			if (bingo) return;

			if (
				(board[indices[0]][0] && board[indices[0]][1] && board[indices[0]][2] && board[indices[0]][3] && board[indices[0]][4]) ||
				(board[0][indices[1]] && board[1][indices[1]] && board[2][indices[1]] && board[3][indices[1]] && board[4][indices[1]]) ||
				(board[0][0] && board[1][1] && board[2][2] && board[3][3] && board[4][4]) ||
				(board[0][4] && board[1][3] && board[2][2] && board[3][1] && board[4][0])
			) {
				bingo = true;
				endTime = Date.now();

				// thank you tsParticles (https://confetti.js.org/more.html)
				// --- BEGIN COPY ---
				const duration = 15 * 1000,
					animationEnd = Date.now() + duration,
					defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

				function randomInRange(min, max) {
					return Math.random() * (max - min) + min;
				}

				const interval = setInterval(function () {
					const timeLeft = animationEnd - Date.now();

					if (timeLeft <= 0) {
						return clearInterval(interval);
					}

					const particleCount = 50 * (timeLeft / duration);

					// since particles fall down, start a bit higher than random
					confetti(
						Object.assign({}, defaults, {
							particleCount,
							origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
						})
					);
					confetti(
						Object.assign({}, defaults, {
							particleCount,
							origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
						})
					);
				}, 250);
				// --- END COPY ---
			}
		}

		// PREVENT LOSS OF PROGRESS
		function onBeforeUnload(event) {
			event.preventDefault();
		}
		if (!window.location.href.includes("://localhost:")) window.addEventListener("beforeunload", onBeforeUnload);

		// TIME FORMATTING UTILITY
		function formatTimeString(timestamp) {
			let hours = Math.floor(timestamp / 3600);
			let minutes = Math.floor((timestamp % 3600) / 60);
			let seconds = Math.floor((timestamp % 3600) % 60);

			if (hours == 0) return `${minutes.toString()}:${seconds.toString().padStart(2, "0")}`;
			else return `${hours.toString()}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
		}

		// SUBMIT BOARD
		let endTime = 0;
		async function submitBoard() {
			// TIME CALCULATIONS
			if (endTime == 0) endTime = Date.now();
			let totalTime = Math.floor((endTime - startTime) / 1000);

			// SHARE TEXT
			let shareText = `Bus Ride Bingo ‚Äî ${formatTimeString(totalTime)}\n`;
			let boardText = "|";
			let rowCount = 0;
			document.querySelectorAll(".square").forEach((square) => {
				if (square.classList.contains("filled")) {
					if (bingo) shareText += "üü©";
					else shareText += "üüß";
					boardText += "x";
				} else {
					shareText += "‚¨õ";
					boardText += "-";
				}

				if (++rowCount == 5) {
					rowCount = 0;
					shareText += "\n";
					boardText += "|";
				}
			});
			shareText += "https://pinniped.page/brb";
			navigator.clipboard.writeText(shareText);

			// TELL PEOPLE SOMETHING WAS COPIED
			let savedText = document.querySelector("#submit").innerHTML;
			document.querySelector("#submit").innerHTML = "&nbsp;COPIED!&nbsp;";

			if (!window.location.href.includes("://localhost:")) await addToDatabase(boardText, startTime, endTime, endTime - startTime);

			// RELOAD
			if (!window.location.href.includes("://localhost:")) window.removeEventListener("beforeunload", onBeforeUnload);
			window.location.reload();
		}

		// MAKE PHRASES DATABASE-SAFE
		function formatDatabaseKey(string) {
			return string
				.replace(/\//g, "<slash>")
				.replace(/\./g, "<dot>")
				.replace(/\#/g, "<hash>")
				.replace(/\$/g, "<dollar>")
				.replace(/\[/g, "<leftbrace>")
				.replace(/\]/g, "<rightbrace>")
				.replace(/\&rsquo;/g, "‚Äô");
		}

		// DATABASE SEND
		async function addToDatabase(board, start, end, total) {
			const database = getDatabase();

			// UPDATE EVENT COUNTS IN DATABASE
			document.querySelectorAll(".square").forEach(async (square) => {
				let phrase = formatDatabaseKey(square.title);
				let nextCount = 0;
				await get(ref(database, `brb/events/${phrase}`))
					.then((snapshot) => {
						if (snapshot.exists()) nextCount = parseInt(snapshot.val());
						console.log(`%creceived data from database @ ‚Äúbrb/events/${phrase}‚Äù (${snapshot.val()})`, blueStyle);
					})
					.catch((error) => {
						console.log(`%cerror fetching from database @ ‚Äúbrb/events/${phrase}‚Äù`, redStyle);
					});
				if (square.classList.contains("filled")) nextCount++;
				await set(ref(database, `brb/events/${phrase}`), nextCount)
					.then((success) => {
						console.log(`%cset database value @ ‚Äúbrb/events/${phrase}‚Äù to ${nextCount}`, blueStyle);
					})
					.catch((error) => {
						console.log(`%cerror setting database value @ ‚Äúbrb/events/${phrase}‚Äù`, redStyle);
					});
			});

			// GAME-SPECIFIC
			await push(ref(database, `brb/games`), {
				board: board,
				times: {
					start: start,
					end: end,
					total: total,
				},
			})
				.then((success) => {
					console.log(`%cset database value @ ‚Äúbrb/games/‚Äù`, blueStyle);
				})
				.catch((error) => {
					console.log(`%cerror pushing to database @ ‚Äúbrb/games/‚Äù`, redStyle);
				});
		}

		// DATABASE RECEIVE
		async function getFromDatabase() {
			const database = getDatabase();

			// EVENTS
			let events = [];

			// VALIDATE DATABASE (EVENTS) & SAVE NUMBERS
			squares.push(`bus moves (free space?) üëÄ`);
			for (let phrase of squares) {
				let safePhrase = formatDatabaseKey(phrase);
				await get(ref(database, `brb/events/${safePhrase}`))
					.then(async (snapshot) => {
						if (snapshot.exists()) {
							if (!/\d+/.test(snapshot.val())) {
								await set(ref(database, `brb/events/${safePhrase}`), 0)
									.then((success) => {
										console.log(`%creplaced bad data from database @ ‚Äúbrb/events/${safePhrase}‚Äù with ${0}`, yellowStyle);
									})
									.catch((error) => {
										console.log(`%cerror setting database value @ ‚Äúbrb/events/${safePhrase}‚Äù`, redStyle);
										document.querySelector("#events-load").innerHTML = "ERROR";
									});
								events.push([phrase, 0]);
							} else {
								console.log(`%ccorrect pattern @ ‚Äúbrb/events/${safePhrase}‚Äù (${snapshot.val()})`, blueStyle);
								console.log(snapshot.val());
								events.push([phrase, parseInt(snapshot.val())]);
							}
						} else {
							await set(ref(database, `brb/events/${safePhrase}`), 0)
								.then((success) => {
									console.log(`%cset database value @ ‚Äúbrb/events/${safePhrase}‚Äù to ${0}`, blueStyle);
								})
								.catch((error) => {
									console.log(`%cerror setting database value @ ‚Äúbrb/events/${safePhrase}‚Äù`, redStyle);
									document.querySelector("#events-load").innerHTML = "ERROR";
								});
							events.push([phrase, 0]);
						}
					})
					.catch((error) => {
						console.log(`%cerror fetching from database @ ‚Äúbrb/events/${safePhrase}‚Äù`, redStyle);
						document.querySelector("#events-load").innerHTML = "ERROR";
					});
			}
			squares.pop(`bus moves (free space?) üëÄ`);
			events.pop(`bus moves (free space?) üëÄ`);

			// SORT
			events.sort(function (a, b) {
				return b[1] - a[1];
			});

			// ADD TO PAGE
			for (let i = 0; i < events.length; i++) {
				let number = events[i][1];
				let percent = (number / events[0][1]) * 100;

				let statElement = document.createElement("div");
				statElement.classList.add("stat");
				statElement.innerHTML = `<div>&ldquo;${events[i][0]}&rdquo; ‚Äî <b>&nbsp;${events[i][1]}</b></div>`;
				document.querySelector(".stats .events").appendChild(statElement);

				statElement.style = `width: ${percent}%`;
			}
			if (events.length == 60) document.querySelector("#events-load").remove();
			else document.querySelector("#events-load").innerHTML = "ERROR";

			// GAMES
			let games = {};

			// VALIDATE DATABASE (GAMES) & SAVE
			await get(ref(database, `brb/games`))
				.then(async (snapshot) => {
					console.log(`%creceived data from database @ ‚Äúbrb/games‚Äù`, blueStyle);

					if (snapshot.exists()) {
						games = snapshot.val();

						for (let game in games) {
							if (Object.keys(games[game]).length == 2 && Object.keys(games[game]).includes("board") && Object.keys(games[game]).includes("times")) {
								if (/^\|([x-]{5}\|){2}[x-]{2}x[x-]{2}\|([x-]{5}\|){2}$/.test(games[game].board)) {
									if (
										Object.keys(games[game].times).length == 3 &&
										Object.keys(games[game].times).includes("end") &&
										Object.keys(games[game].times).includes("start") &&
										Object.keys(games[game].times).includes("total")
									) {
										if (!isNaN(games[game].times.end) && !isNaN(games[game].times.start) && !isNaN(games[game].times.total)) {
											continue;
										}
									}
								}
							}

							delete games[game];
							await remove(ref(database, `brb/games/${game}`))
								.then((success) => {
									console.log(`%cremoved bad data from database @ ‚Äúbrb/games/${game}‚Äù`, yellowStyle);
								})
								.catch((error) => {
									console.log(`%cerror removing database entry @ ‚Äúbrb/games/${game}‚Äù`, redStyle);
									document.querySelector("#games-load").innerHTML = "ERROR";
								});
						}
					}
				})
				.catch((error) => {
					console.log(`%cerror fetching from database @ ‚Äúbrb/games‚Äù`, redStyle);
					document.querySelector("#games-load").innerHTML = "ERROR";
				});

			let total = 0;
			let longest = 0;
			let shortest = Infinity;
			let average = 0;
			let times = {};
			for (let game in games) {
				total++;
				if (games[game].times.total > longest) longest = games[game].times.total;
				if (games[game].times.total < shortest) shortest = games[game].times.total;
				average += games[game].times.total;

				let date = new Date(games[game].times.start);
				let hours = date.getHours();
				let half = " AM";
				if (date.getHours() >= 12) half = " PM";
				hours = hours % 12;
				if (hours == 0) hours = 12;
				let key = `${hours}:${date.getMinutes().toString().padStart(2, "0")}${half}`;
				if (key in times) times[key]++;
				else times[key] = 1;
			}

			let stats = [
				["games submitted", total.toLocaleString("en-CA")],
				["longest game length", formatTimeString(Math.floor(longest / 1000))],
				["shortest game length", formatTimeString(Math.floor(shortest / 1000))],
				["average game length", formatTimeString(Math.floor(average / 1000 / total))],
				["most common start time", Object.keys(times)[Object.values(times).indexOf(Math.max(...Object.values(times)))]],
			];

			for (let i = 0; i < stats.length; i++) {
				let statElement = document.createElement("span");
				statElement.innerHTML = `${stats[i][0]}: <b>${stats[i][1]}</b><br /><br />`;
				document.querySelector(".games").appendChild(statElement);
			}

			document.querySelector("#games-load").remove();
		}
		getFromDatabase();

		// LISTEN FOR BUTTON USE
		document.querySelector("#submit").addEventListener("click", () => {
			submitBoard();
		});
		document.querySelector("#resize").addEventListener("click", () => {
			shrinkToFit();
		});

		// CONSIDER LOADING DONE, START TIMER
		const startTime = Date.now();
		console.log(`%ctimer started @ ${startTime}`, blueStyle);
	</script>
</html>
