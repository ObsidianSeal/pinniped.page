<!DOCTYPE html>

<html lang="en">
	<head>
		<title>Bus Ride Bingo</title>

		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="theme-color" content="#4ecdc4" />

		<link rel="icon" href="../images/icon.png" />

		<meta property="og:url" content="https://pinniped.page/projects/brb" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="BUS RIDE BINGO" />
		<meta property="og:description" content="BUS RIDE BINGO" />
		<meta property="og:image" content="https://pinniped.page/images/icon.png" />

		<script src="https://kit.fontawesome.com/c6ef7d4818.js" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/tsparticles-confetti@2.12.0/tsparticles.confetti.bundle.min.js"></script>

		<style>
			@import url("https://fonts.googleapis.com/css2?family=Roboto");

			:root {
				--background: #f4f1de;
				--foreground: #3d405b;
				--accent1: #e07a5f;
				--accent2: #f2cc8f;
				--accent3: #81b29a;
			}

			::selection {
				background-color: var(--foreground);
				color: var(--background);
			}

			* {
				font-family: "Roboto";
				font-size: 20px;
			}

			body {
				display: flex;
				align-items: center;
				justify-content: center;

				background-color: var(--background);
				color: var(--foreground);

				margin: 0;
				border: 0;
				padding: 20px;
			}

			table {
				aspect-ratio: 1 / 1;

				margin: 0;
				border: 3px solid var(--foreground);
				border-collapse: collapse;
				padding: 0;
			}

			td {
				width: 20%;
				height: 20%;

				aspect-ratio: 1 / 1;

				margin: 0;
				border: 3px solid var(--foreground);
				padding: 5px;

				text-align: center;
			}

			td:hover {
				cursor: pointer;
			}

			i:hover {
				color: var(--accent1);
				cursor: pointer;
			}

			.filled {
				background-color: var(--accent3);
			}

			.filled::selection {
				background-color: var(--foreground);
				color: var(--accent3);
			}

			@media all and (max-width: 800px), (max-height: 800px) {
				* {
					font-size: 16px;
				}
			}

			@media all and (max-width: 700px), (max-height: 700px) {
				* {
					font-size: 14px;
				}
			}

			@media all and (max-width: 600px), (max-height: 600px) {
				* {
					font-size: 12px;
				}
			}

			@media all and (max-width: 500px), (max-height: 500px) {
				* {
					font-size: 10px;
				}

				body {
					padding: 10px;
				}

				td {
					padding: 2px;
				}
			}

			@media all and (max-width: 430px), (max-height: 430px) {
				* {
					font-size: 8px;
				}
			}

			@media all and (max-width: 340px), (max-height: 340px) {
				* {
					font-size: 6px;
				}
			}
		</style>

		<style id="autoStyles">
			table {
				width: 100%;
				max-width: 670px;
				max-height: 670px;
			}
		</style>

		<style id="autoStyles2"></style>
	</head>

	<body>
		<table>
			<tr>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
		</table>

		<i class="fa-solid fa-maximize" style="font-size: 30px; position: fixed; right: 30px; bottom: 30px" id="demo"></i>

		<script>
			// the board && bingo var
			var bingo = false;
			const board = [
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
			];

			// "perfect position on mobile too", and sizing on smaller screens! from https://pinniped.page/projects/chess/board
			function autoStyle() {
				const screenWidth = window.innerWidth;
				const screenHeight = window.innerHeight;

				if (screenWidth > 500 && screenHeight > 500) {
					document.querySelector("body").style = `height: ${screenHeight - 40}px`;
				} else {
					document.querySelector("body").style = `height: ${screenHeight - 20}px`;
				}

				if (screenHeight < 720) {
					document.querySelector("#autoStyles").innerHTML = `table { width: 100%; max-width: ${screenHeight - 40}px; max-height: ${screenHeight - 40}px; }`;
				} else {
					document.querySelector("#autoStyles").innerHTML = `table { width: 100%; max-width: 670px; max-height: 670px; }`;
				}
			}
			autoStyle();

			// fill screen button
			const button = document.querySelector("i");
			button.addEventListener("click", (e) => {
				if (button.classList.contains("fa-maximize")) {
					document.querySelector("#autoStyles2").innerHTML = `body { display: block; } table { width: 100%; height: 100%; max-width: 100%; max-height: 100%; }`;
					button.classList.remove("fa-maximize");
					button.classList.add("fa-minimize");
				} else {
					document.querySelector("#autoStyles2").innerHTML = ``;
					button.classList.remove("fa-minimize");
					button.classList.add("fa-maximize");
				}
			});

			// do it when resize
			addEventListener("resize", (e) => {
				setTimeout(() => {
					autoStyle();
				}, 500);
			});

			// what goes in the squares
			const squares = [
				"detour ðŸš§",
				"see or be on an articulated bus ðŸš",
				"pass a bus on the same route and direction ðŸšŽ",
				"driver speaks (not about fare or directions) ðŸ‘¨â€ðŸ¦°",
				`directions given / "does this bus go to ___?" ðŸ¤·â€â™‚ï¸`,
				"wheelchair or similar is on the bus ðŸ‘¨â€ðŸ¦¼",
				"driver gets up from seat (not for a wheelchair) ðŸ¦¶",
				"bus honk! ðŸš˜",
				"someone's stop is missed ðŸ›‘",
				"arrive at your stop (last chance for bingo!) ðŸš",
				"people are standing ðŸ§â€â™€ï¸",
				"go under a bridge (or through a tunnel) ðŸš‡",
				"go on a bridge ðŸŒ‰",
				"stroller ðŸ‘¶",
				"someone gets off where people normally can't ðŸ‘¨â€ðŸ¦¯",
				"bus goes up onto the curb ðŸ˜¯",
				"something falls on the floor ðŸ˜¬",
				"sitting at a stop... (no one getting on/off) ðŸª‘",
				"someone is running for the bus! (waiting) ðŸƒâ€â™€ï¸",
				"go over or under railroad tracks ðŸš†",
				"bus only lane! ðŸš‹",
				"pass a stop with a shelter ðŸ ",
				"someone speaks in a language you don't ðŸ’¬",
				"skip a stop ðŸš«",
				"accidental stop request ðŸ˜®",
				"door doesn't open or can't close ðŸšª",
				"5+ people board ðŸš¶â€â™‚ï¸",
				"5+ people get off ðŸš¶â€â™€ï¸",
				"people at a stop are waiting for a different bus ðŸ–",
				"driver waves at other bus driver ðŸ‘‹",
				"another bus is in the next lane (same direction) ðŸ›´",
				"someone is sitting next to you ðŸ˜",
				"see an express bus ðŸšŒ",
				"travel on a road with 4+ lanes ðŸ§ ",
				"travel on a one-way road â©",
				"hear music ðŸŽ¶",
				"someone's on the phone or talking loudly ðŸ¦œ",
				"see a taxi or mail, garbage, or recycling truck ðŸš•",
				"someone uses the bike rack ðŸš²",
				"bus kneels ðŸ§Žâ€â™‚ï¸",
				"another bus driver/transit staff is on the bus ðŸ‘¨â€âœˆï¸",
				"someone goes out the front door ðŸ‘ ",
				"see/pass a school ðŸ«",
				"dirty seat / someone coughs ðŸ™",
				"see a non-transit bus ðŸŽ’",
				"see a city bus that isn't on a route ðŸ‘â€ðŸ—¨",
				"see an emergency vehicle ðŸš‘",
				"pass scanner doesn't work ðŸ¥¨",
			];

			// mix array for random bingo card; from https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
			function shuffle(array) {
				let currentIndex = array.length,
					randomIndex;

				while (currentIndex != 0) {
					randomIndex = Math.floor(Math.random() * currentIndex);
					currentIndex--;

					[array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
				}

				return array;
			}

			// do the mix!
			shuffle(squares);
			console.log(`BRB v1.${9}\n\nShuffled list of all ${squares.length} possible squares:`); // so I can see how many elements there are | UPDATE VERSION EVERY COMMIT
			console.log(squares);

			// detect bingo function
			function checkForBingo() {
				// horizontal
				if (board[0] && board[1] && board[2] && board[3] && board[4]) return true;
				if (board[5] && board[6] && board[7] && board[8] && board[9]) return true;
				if (board[10] && board[11] && board[12] && board[13] && board[14]) return true;
				if (board[15] && board[16] && board[17] && board[18] && board[19]) return true;
				if (board[20] && board[21] && board[22] && board[23] && board[24]) return true;

				// vertical
				if (board[0] && board[5] && board[10] && board[15] && board[20]) return true;
				if (board[1] && board[6] && board[11] && board[16] && board[21]) return true;
				if (board[2] && board[7] && board[12] && board[17] && board[22]) return true;
				if (board[3] && board[8] && board[13] && board[18] && board[23]) return true;
				if (board[4] && board[9] && board[14] && board[19] && board[24]) return true;

				// diagonal
				if (board[0] && board[6] && board[12] && board[18] && board[24]) return true;
				if (board[4] && board[8] && board[12] && board[16] && board[20]) return true;

				return false;
			}

			// set each square's id, add a click listener (invert square state) + handle bingo
			let i = 0;
			var started = false;
			document.querySelectorAll("td").forEach((square) => {
				square.setAttribute("id", i);

				if (i < 12) square.innerHTML = squares[i];
				if (i == 12) square.innerHTML = "bus moves (free space?)";
				if (i > 12 && i < 25) square.innerHTML = squares[i - 1];

				i++;

				square.addEventListener("click", (e) => {
					// prevent accidentally generating a new board, triggered by first square press, from https://stackoverflow.com/questions/1119289/how-to-show-the-are-you-sure-you-want-to-navigate-away-from-this-page-when-ch
					if (!bingo) {
						window.onbeforeunload = function () {
							return true;
						};
					}

					if (square.classList.contains("filled")) square.classList.remove("filled");
					else square.classList.add("filled");

					board[square.id] = !board[square.id]; // set the square to true or false
					if (checkForBingo() && !bingo) {
						bingo = true; // prevent more than one bingo (too much confetti)
						window.onbeforeunload = null; // now you can leave or reload
						// if there's a bingo, CONFETTI!!! thanks to https://confetti.js.org/
						// ----- CTRL+C CTRL+V confetti BEGINS: -----

						const duration = 15 * 1000,
							animationEnd = Date.now() + duration,
							defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

						function randomInRange(min, max) {
							return Math.random() * (max - min) + min;
						}

						const interval = setInterval(function () {
							const timeLeft = animationEnd - Date.now();

							if (timeLeft <= 0) {
								return clearInterval(interval);
							}

							const particleCount = 50 * (timeLeft / duration);

							// since particles fall down, start a bit higher than random
							confetti(
								Object.assign({}, defaults, {
									particleCount,
									origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
								})
							);
							confetti(
								Object.assign({}, defaults, {
									particleCount,
									origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
								})
							);
						}, 250);

						// ----- CTRL+C CTRL+V confetti ENDS: -----
					}
				});
			});
		</script>
	</body>
</html>
