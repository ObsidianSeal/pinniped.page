<!DOCTYPE html>

<html lang="en">
	<head>
		<title>Think Four | pinniped.page</title>

		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<meta name="theme-color" content="#4ecdc4" />

		<link rel="icon" href="../images/icon.png" />

		<meta property="og:url" content="https://pinniped.page/projects/think-four" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="Think Four" />
		<meta property="og:description" content="Determine the topics, group the words." />
		<meta property="og:image" content="https://pinniped.page/images/icon.png" />

		<meta name="description" content="Determine the topics, group the words." />
		<meta name="keywords" content="topics, words, puzzle, connections, fun, share, think, four, sixteen, guess" />

		<script src="https://kit.fontawesome.com/c6ef7d4818.js" crossorigin="anonymous"></script>

		<style>
			/* Bebas Neue Rounded from Adobe Fonts */
			@import url(https://use.typekit.net/rzo4wst.css);

			/* Roboto Slab from Google Fonts */
			@import url("https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700");

			:root {
				/* default Photoshop swatches */
				--white: #ffffff;
				--grey10: #ebebeb;
				--grey15: #e1e1e1;
				--grey20: #d7d7d7;
				--grey25: #cccccc;
				--grey30: #c2c2c2;
				--grey35: #b7b7b7;
				--grey40: #acacac;
				--grey45: #a1a1a1;
				--grey50: #959595;
				--grey55: #898989;
				--grey60: #7d7d7d;
				--grey65: #707070;
				--grey70: #636363;
				--grey75: #555555;
				--grey80: #464646;
				--grey85: #363636;
				--grey90: #252525;
				--grey95: #111111;
				--black: #000000;

				/* colours from the Coolors 'Explore' page */
				--red: #e76f51;
				--orange: #f4a261;
				--yellow: #e9c46a;
				--green: #a3b18a;

				--blue-green: #2a9d8f;
				--dark-blue-green: #264653;

				--green1: #dad7cd;
				--green2: #588157;
				--green3: #3a5a40;
				--green4: #344e41;

				--board-width: 660px;
				--board-height: 460px;
				--gap: 20px;
				--padding: 10px;
			}

			/* all & specific elements */

			* {
				margin: 0;
				border: 0;
				padding: 0;

				font-family: bebas-neue-rounded, sans-serif;
				font-style: normal;
				font-weight: 400;
				font-size: 32px;

				-webkit-tap-highlight-color: transparent;

				touch-action: manipulation;
			}

			body {
				background-color: var(--grey10);
			}

			h1 {
				font-size: 128px;
				color: var(--blue-green);
			}

			h2 {
				font-size: 48px;
				color: var(--dark-blue-green);
			}

			h3,
			h4 {
				position: absolute;
				font-size: 30px;
				color: var(--grey60);
			}

			h3:hover,
			h3:focus,
			h4:hover,
			h4:focus {
				cursor: pointer;
				color: var(--black);
			}

			h3 {
				top: 50px;
				right: 50px;
			}

			h4 {
				bottom: 50px;
				left: 50px;
			}

			/* classes */

			.game-container {
				width: 100%;
				height: 100%;

				display: flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;
				gap: 40px;
			}

			.board {
				width: var(--board-width);
				height: var(--board-height);
			}

			.word {
				width: calc(((var(--board-width) - (var(--gap) * 3)) / 4) - (var(--padding) * 2));
				height: calc(((var(--board-height) - (var(--gap) * 3)) / 4) - (var(--padding) * 2));
				min-width: fit-content;
				min-height: fit-content;
				background-color: var(--grey20);
				padding: var(--padding);

				position: absolute;

				display: flex;
				align-items: center;
				justify-content: center;

				border-radius: 5px;

				transition: top 1s, left 1s;
			}

			.word:not(.disabled):hover {
				cursor: pointer;
			}

			.solved {
				width: var(--board-width);
				height: calc((var(--board-height) - (var(--gap) * 3)) / 4);

				position: absolute;

				display: flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;

				border-radius: 5px;
			}

			.solved div:last-child {
				opacity: 50%;
			}

			.solved.new-solve {
				animation: appear 300ms;
			}

			.red {
				background-color: var(--red);
			}

			.orange {
				background-color: var(--orange);
			}

			.yellow {
				background-color: var(--yellow);
			}

			.green {
				background-color: var(--green);
			}

			.incorrect {
				animation: shake 600ms;
			}

			.selected {
				background-color: var(--grey40);
			}

			.buttons {
				width: var(--board-width);

				display: flex;
				justify-content: center;
				gap: 80px;
			}

			.clear,
			.submit,
			.results {
				width: 200px;
				height: 50px;

				background-color: var(--grey15);

				border: 2px solid var(--grey40);
				border-radius: 5px;

				display: flex;
				align-items: center;
				justify-content: center;
			}

			.clear.disabled,
			.submit.disabled {
				background-color: var(--grey10);
				border-color: var(--grey20);
				color: var(--grey40);
			}

			.clear:not(.disabled):hover,
			.clear:not(.disabled):focus,
			.submit:not(.disabled):hover,
			.submit:not(.disabled):focus,
			.results:hover,
			.results:focus {
				border-color: var(--grey60);
				cursor: pointer;
			}

			.loading-container,
			.win-container {
				position: absolute;
				top: 0;
				left: 0;
				background-color: var(--green1);

				width: 100%;
				height: 100%;

				display: flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;

				z-index: 1;
			}

			.loading-text,
			.win-title {
				color: var(--blue-green);
				font-size: 160px;

				text-align: center;
			}

			.version,
			.loading-help,
			.win-text,
			.win-buttons {
				color: var(--dark-blue-green);
				padding: 0 20px;
				text-align: center;
			}

			.copy-alert {
				width: 120px;
				height: 50px;

				background-color: var(--dark-blue-green);
				color: var(--green1);
				border-radius: 5px;

				display: flex;
				align-items: center;
				justify-content: center;

				position: absolute;
				top: 80px;
			}

			.loading-help,
			.win-buttons,
			.puzzle-select-buttons {
				margin-top: 40px;
			}

			.loading-help:hover,
			.loading-help:focus,
			.win-buttons span:hover,
			.win-buttons span:focus,
			.rate-puzzle span:last-child:not(.disabled):hover,
			.rate-puzzle span:last-child:not(.disabled):focus {
				color: var(--red);
				cursor: pointer;
			}

			.puzzle-select-buttons {
				color: var(--dark-blue-green);
				display: flex;
				gap: 20px;
			}

			.puzzle-select-buttons span.disabled,
			.rate-puzzle span.disabled,
			.rate-puzzle div i.disabled {
				opacity: 50%;
			}

			.puzzle-select-buttons span:not(.disabled):hover,
			.puzzle-select-buttons span:not(.disabled):focus {
				color: var(--red);
				cursor: pointer;
			}

			.titles {
				position: absolute;
				top: 50px;
				left: 50px;
			}

			.puzzle-rating {
				margin-top: 10px;
				color: var(--dark-blue-green);
				width: calc(100vw - 50px);
			}

			.puzzle-rating i {
				font-size: 36px;
			}

			.rate-puzzle {
				margin-top: 80px;
				color: var(--dark-blue-green);
				text-align: center;
			}

			.rate-puzzle div {
				margin-bottom: 20px;
			}

			/* a lot of very interesting reading on https://stackoverflow.com/questions/1817792/is-there-a-previous-sibling-selector */

			.rate-puzzle div:has(i:not(.disabled):hover):hover i:not(.disabled) {
				color: var(--red);
			}

			.rate-puzzle div:has(i:not(.disabled):hover) i:not(.disabled):hover ~ i:not(.disabled) {
				color: var(--dark-blue-green);
			}

			.rate-puzzle i {
				font-size: 28px;
			}

			.rate-puzzle i:not(.disabled):hover {
				cursor: pointer;
			}

			.hide {
				display: none;
			}

			.notice-panel-container {
				position: fixed;
				top: 0;
				left: 0;

				background-color: #00000064;

				display: flex;
				justify-content: center;
				align-items: center;

				padding: 30px;
				width: calc(100% - 60px);
				height: calc(100% - 60px);
			}

			.notice-panel {
				position: relative;

				border: 5px solid var(--red);
				border-radius: 8px;

				background-color: var(--grey10);

				max-width: 850px;
			}

			.notice-panel i {
				position: absolute;
				top: 10px;
				right: 10px;

				color: var(--grey60);
			}

			.notice-panel i:hover,
			.notice-panel i:focus {
				color: var(--black);
				cursor: pointer;
			}

			.notice-panel p {
				margin: 10px 20px;

				font-family: "Roboto Slab";
				font-weight: 400;
				font-size: 24px;
			}

			.notice-panel p:first-child {
				font-weight: 700;
				font-size: 32px;
				margin: 10px 60px 10px 20px;
			}

			.notice-panel p:first-child span {
				font-weight: 700;
				font-size: 32px;
			}

			.notice-panel span {
				font-family: "Roboto Slab";
			}

			.notice-panel span:not(.game-name) {
				font-size: 24px;
			}

			.notice-panel a {
				font-family: "Roboto Slab";
				font-weight: 400;
				font-size: 24px;

				color: var(--black);
				text-decoration-color: var(--grey40);
				text-decoration-skip-ink: none;
			}

			.notice-panel p:first-child a {
				font-weight: 700;
				font-size: 32px;
			}

			.notice-panel a:hover {
				text-decoration-color: var(--red);
			}

			.game-name {
				color: var(--red);

				font-weight: 700;
			}

			.notice-panel.green2 {
				border-color: var(--green2);
			}

			.notice-panel.green2 .game-name {
				color: var(--green2);
			}

			.notice-panel.green2 a:hover {
				text-decoration-color: var(--green2);
			}

			/* SELECTION */

			h3,
			h4,
			.word,
			.buttons,
			.loading-container,
			.win-container,
			.puzzle-rating {
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			h1::selection,
			h2::selection,
			p::selection,
			.notice-panel *::selection {
				background-color: var(--grey20);
			}

			.red div::selection {
				background-color: var(--black);
				color: var(--red);
			}

			.orange div::selection {
				background-color: var(--black);
				color: var(--orange);
			}

			.yellow div::selection {
				background-color: var(--black);
				color: var(--yellow);
			}

			.green div::selection {
				background-color: var(--black);
				color: var(--green);
			}

			/* loading dots & animations */

			#d1,
			#d2,
			#d3 {
				opacity: 0%;
			}

			.loading-text #d1,
			.loading-text #d2,
			.loading-text #d3 {
				font-size: 160px;
			}

			.version #d1,
			.version #d2,
			.version #d3 {
				font-size: 32px;
			}

			#d1 {
				animation: d1 2.5s infinite 0.5s;
			}

			#d2 {
				animation: d2 2.5s infinite 0.5s;
			}

			#d3 {
				animation: d3 2.5s infinite 0.5s;
			}

			@keyframes appear {
				50% {
					transform: scale(1.1);
				}
			}

			@keyframes shake {
				20% {
					transform: translateX(10px);
				}
				40% {
					transform: translateX(-10px);
				}
				60% {
					transform: translateX(10px);
				}
				80% {
					transform: translateX(-10px);
				}
			}

			@keyframes d1 {
				0% {
					opacity: 0%;
				}
				20% {
					opacity: 100%;
				}
				40% {
					opacity: 100%;
				}
				60% {
					opacity: 100%;
				}
				80% {
					opacity: 100%;
				}
				100% {
					opacity: 0%;
				}
			}

			@keyframes d2 {
				0% {
					opacity: 0%;
				}
				20% {
					opacity: 0%;
				}
				40% {
					opacity: 100%;
				}
				60% {
					opacity: 100%;
				}
				80% {
					opacity: 100%;
				}
				100% {
					opacity: 0%;
				}
			}

			@keyframes d3 {
				0% {
					opacity: 0%;
				}
				20% {
					opacity: 0%;
				}
				40% {
					opacity: 0%;
				}
				60% {
					opacity: 100%;
				}
				80% {
					opacity: 100%;
				}
				100% {
					opacity: 0%;
				}
			}

			/* MEDIA QUERIES */

			@media all and (max-width: 700px) {
				:root {
					--board-width: 430px;
					--board-height: 330px;
					--gap: 10px;
				}

				h1 {
					font-size: 80px;
				}

				h2 {
					font-size: 36px;
				}

				.solved div {
					font-size: 24px;
				}

				.buttons {
					gap: 40px;
				}

				.clear,
				.submit {
					width: 150px;
				}

				.loading-text,
				.win-title,
				.loading-text #d1,
				.loading-text #d2,
				.loading-text #d3 {
					font-size: 120px;
				}

				.puzzle-rating {
					margin-top: 0;
				}

				.puzzle-rating i {
					font-size: 28px;
				}

				.remove700 {
					display: none;
				}

				@keyframes shake {
					20% {
						transform: translateX(5px);
					}
					40% {
						transform: translateX(-5px);
					}
					60% {
						transform: translateX(5px);
					}
					80% {
						transform: translateX(-5px);
					}
				}
			}

			@media all and (max-width: 450px) {
				:root {
					--board-width: 330px;
					--board-height: 230px;
					--gap: 10px;
					--padding: 5px;
				}

				h1 {
					font-size: 56px;
				}

				h2 {
					font-size: 28px;
				}

				h3 {
					top: 30px;
					right: 30px;
				}

				h4 {
					bottom: 30px;
					left: 30px;
				}

				.titles {
					top: 30px;
					left: 30px;
				}

				.solved div {
					font-size: 16px;
				}

				.buttons {
					gap: 30px;
				}

				.clear,
				.submit {
					width: 120px;
				}

				.loading-text,
				.win-title,
				.loading-text #d1,
				.loading-text #d2,
				.loading-text #d3 {
					font-size: 60px;
				}

				.version,
				.loading-help,
				.win-text,
				.win-text span,
				.win-buttons,
				.win-buttons span,
				.rate-puzzle span {
					font-size: 24px;
				}

				.version #d1,
				.version #d2,
				.version #d3 {
					font-size: 24px;
				}

				.puzzle-rating {
					width: calc(100vw - 30px);
				}

				.puzzle-rating i {
					font-size: 24px;
				}

				.notice-panel p,
				.notice-panel a {
					font-size: 18px;
				}

				.notice-panel p:first-child,
				.game-name {
					font-size: 24px;
				}

				.notice-panel span:not(.game-name) {
					font-size: 18px;
				}

				.notice-panel p:first-child span {
					font-size: 24px;
				}

				.notice-panel p:first-child a {
					font-size: 24px;
				}
			}

			@media all and (max-width: 350px) {
				:root {
					--board-width: 215px;
					--board-height: 115px;
					--gap: 5px;
					--padding: 3px;
				}

				h1 {
					font-size: 48px;
				}

				h2 {
					font-size: 24px;
				}

				h3 {
					top: 20px;
					right: 20px;
				}

				h4 {
					bottom: 20px;
					left: 20px;
				}

				.solved div {
					font-size: 10px;
				}

				.buttons {
					gap: 20px;
				}

				.clear,
				.submit {
					width: 80px;
					font-size: 24px;
				}

				.notice-panel p,
				.notice-panel a {
					font-size: 14px;
				}

				.notice-panel p:first-child,
				.game-name {
					font-size: 18px;
				}

				.notice-panel span:not(.game-name) {
					font-size: 14px;
				}

				.notice-panel p:first-child span {
					font-size: 18px;
				}

				.notice-panel p:first-child a {
					font-size: 18px;
				}

				@keyframes shake {
					20% {
						transform: translateX(3px);
					}
					40% {
						transform: translateX(-3px);
					}
					60% {
						transform: translateX(3px);
					}
					80% {
						transform: translateX(-3px);
					}
				}
			}
		</style>
	</head>

	<body>
		<div class="loading-container">
			<div class="loading-text">loading<d id="d1">.</d><d id="d2">.</d><d id="d3">.</d></div>
			<div class="version">loading<d id="d1">.</d><d id="d2">.</d><d id="d3">.</d></div>
			<div class="loading-help" tabindex="0">internet-unrelated loading issue?</div>
		</div>

		<div class="game-container">
			<div class="titles">
				<h1>Think Four</h1>
				<h2>unknown_date</h2>
				<div class="puzzle-rating">
					<i class="fa-regular fa-star"></i>
					<i class="fa-regular fa-star"></i>
					<i class="fa-regular fa-star"></i>
					<i class="fa-regular fa-star"></i>
					<i class="fa-regular fa-star"></i>
				</div>
			</div>
			<h3 tabindex="0">exit</h3>
			<h4 tabindex="0">help!</h4>

			<div class="board"></div>
			<div class="buttons">
				<div class="clear disabled" tabindex="0">clear</div>
				<div class="submit disabled" tabindex="0">submit</div>
			</div>
		</div>

		<div class="win-container hide">
			<div class="win-title"></div>
			<div class="win-text">you solved the puzzle in <span>_</span> guesses!</div>
			<div class="win-buttons"><span tabindex="0">share</span> / <span tabindex="0">close</span> / <span tabindex="0">exit</span></div>
			<div class="puzzle-select-buttons">
				<span title="first puzzle" tabindex="0"><i class="fa-solid fa-backward-step"></i></span>
				<span title="previous puzzle" tabindex="0"><i class="fa-solid fa-backward"></i></span>
				<span title="random puzzle" tabindex="0"><i class="fa-solid fa-dice-five"></i></span>
				<span title="next puzzle" tabindex="0"><i class="fa-solid fa-forward"></i></span>
				<span title="last puzzle" tabindex="0"><i class="fa-solid fa-forward-step"></i></span>
			</div>
			<div class="rate-puzzle">
				<span>rate puzzle:</span>
				<div>
					<i class="fa-regular fa-star" tabindex="0" id="star1"></i>
					<i class="fa-regular fa-star" tabindex="0" id="star2"></i>
					<i class="fa-regular fa-star" tabindex="0" id="star3"></i>
					<i class="fa-regular fa-star" tabindex="0" id="star4"></i>
					<i class="fa-regular fa-star" tabindex="0" id="star5"></i>
				</div>
				<span class="disabled" tabindex="0">submit</span>
			</div>
			<div class="copy-alert hide">copied!</div>
		</div>

		<!-- <div class="notice-panel-container other-font">
			<div class="notice-panel">
				<p>Daily <span class="game-name">Think Four</span> puzzles will (hopefully not) end on <span class="last-puzzle-notice">unknown_date</span>!</p>
				<p>
					If you&rsquo;d like to see Think Four continue, please send me category suggestions (and encouragement) on
					<a href="https://pinniped.page/discord" target="_blank">Discord</a>.
				</p>
				<p>Don&rsquo;t worry—once daily puzzles have run out, all previous puzzles will still be available.</p>
				<p style="display: flex; justify-content: space-between">
					<span>Thanks for playing!</span><span class="remove700" style="color: var(--grey60)">PRESS &ldquo;ESCAPE&rdquo; TO CLOSE</span>
				</p>
				<i class="fa-solid fa-xmark notice-panel-exit" style="width: 32px; display: flex; align-items: center; justify-content: center" tabindex="0"></i>
			</div>
		</div> -->

		<!-- <div class="notice-panel-container other-font">
			<div class="notice-panel green2">
				<p>Welcome to <span class="game-name">Think Four</span> on the <a href="../index.html">pinniped.page</a>!</p>
				<p>Daily puzzles have been set up to <span class="last-puzzle-notice">unknown_date</span>.</p>
				<p>
					A big thank you to everyone who has given me word, category, and puzzle suggestions. As always, if you&rsquo;d like to see Think Four continue, please send
					me category suggestions (and encouragement) on
					<a href="https://pinniped.page/discord" target="_blank">Discord</a>.
				</p>
				<p style="display: flex; justify-content: space-between">
					<span>Thanks for playing!</span><span class="remove700" style="color: var(--grey60)">PRESS &ldquo;ESCAPE&rdquo; TO CLOSE</span>
				</p>
				<i class="fa-solid fa-xmark notice-panel-exit" style="width: 32px; display: flex; align-items: center; justify-content: center" tabindex="0"></i>
			</div>
		</div> -->

		<div class="notice-panel-container other-font">
			<div class="notice-panel">
				<p>The 100th and final <span class="game-name">Think Four</span> puzzle will be on <span class="last-puzzle-notice">unknown_date</span>.</p>
				<p>
					It&rsquo;s been fun, but I can&rsquo;t keep this up and it&rsquo;s time to move on. As always, a huge thank you to to all the people who have given me
					word, category, or puzzle suggestions.
				</p>
				<p>Don&rsquo;t worry—once daily puzzles have run out, all previous puzzles will still be available.</p>
				<p>
					Although a date has been set for the last puzzle, not all of the puzzles up to then have been made, so I still need suggestions!
					<a href="https://pinniped.page/discord" target="_blank">Send them here.</a>
				</p>
				<p style="display: flex; justify-content: space-between">
					<span>Thanks for playing!</span><span class="remove700" style="color: var(--grey60)">PRESS &ldquo;ESCAPE&rdquo; TO CLOSE</span>
				</p>
				<i class="fa-solid fa-xmark notice-panel-exit" style="width: 32px; display: flex; align-items: center; justify-content: center" tabindex="0"></i>
			</div>
		</div>

		<script type="module">
			// --- log styles ---
			const infoStyle = "background: #a3b18a; color: black; padding: 0 5px; border-radius: 10px";
			const warningStyle = "background: #f4a261; color: black; padding: 0 5px; border-radius: 10px";
			const errorStyle = "background: #e76f51; color: black; padding: 0 5px; border-radius: 10px";

			// --- FIREBASE (v10.9.0) ---
			import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
			import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js";

			const firebaseConfig = {
				apiKey: "AIzaSyAigBAgn7Uhybip_m3P508DIpybb2qdI5g",
				authDomain: "the-pinniped-page.firebaseapp.com",
				databaseURL: "https://the-pinniped-page.firebaseio.com",
				projectId: "the-pinniped-page",
				storageBucket: "the-pinniped-page.appspot.com",
				messagingSenderId: "636989973689",
				appId: "1:636989973689:web:6d938d9588606d803a6768",
			};
			const app = initializeApp(firebaseConfig);

			// --- "PERFECT POSITION" ---
			var screenWidth = window.innerWidth;
			var screenHeight = window.innerHeight;
			document.querySelector("body").style = `height: ${screenHeight}px`;

			// TEST: if vertical, and if overlapping with titles: move down, shrink gap between board and buttons [does not update on resize]
			if (screenHeight > screenWidth) {
				if (document.querySelector(".board").getBoundingClientRect().top <= document.querySelector(".titles").getBoundingClientRect().bottom) {
					document.querySelector(".game-container").style = "justify-content: flex-end; gap: 20px";
					document.querySelector(".buttons").style = "margin-bottom: 100px;";
				}
			}

			addEventListener("resize", (e) => {
				setTimeout(() => {
					screenWidth = window.innerWidth;
					screenHeight = window.innerHeight;
					document.querySelector("body").style = `height: ${screenHeight}px`;

					boardRect = document.querySelector(".board").getBoundingClientRect();
					placeWords(true);
					setTitleWidth();
					selectedWords = 0;
				}, 200);
			});

			// --- LOADING PANEL ---
			const versionString = "Think Four v1.7.1.1"; // CHANGE THIS IF YOU MAKE ANY CHANGES (come conditions apply)
			console.log(`%cINFO:`, infoStyle, versionString);
			document.querySelector(".version").innerHTML = versionString;

			document.querySelector(".loading-help").addEventListener("click", (e) => {
				window.location.href = "https://discord.gg/yswDu7kywv";
			});

			// --- ARRAY SHUFFLE, modified from https://bost.ocks.org/mike/shuffle/ ---
			function shuffle(array) {
				var m = array.length;
				while (m) {
					let i = Math.floor(Math.random() * m--);
					[array[i], array[m]] = [array[m], array[i]];
				}
				return array;
			}

			// --- DATE ---
			const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
			const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

			function toTextDate(date) {
				let year = parseInt(date.substring(0, 4));
				let month = parseInt(date.substring(5, 7));
				let day = parseInt(date.substring(8, 10));

				let dateObject = new Date(year, month - 1, day);
				let dayOfWeek = days[dateObject.getDay()];
				month = months[month - 1];

				if (day == 1 || day == 21 || day == 31) day += "st";
				else if (day == 2 || day == 22) day += "nd";
				else if (day == 3 || day == 23) day += "rd";
				else day += "th";

				return `${dayOfWeek}, ${month} ${day}, ${year}`;
			}

			// --- MAKE BOTH ARRAYS 2D (function) ---
			function toFourByFourArray(array) {
				let newArray = [[], [], [], []];
				for (let i = 0; i < array.length; i++) {
					newArray[Math.floor(i / 4)].push(array[i]);
				}
				return newArray;
			}

			// --- MAIN GAME START STUFF ---
			var date, topics, words, mixedWords;
			var dateFromURL = new URLSearchParams(window.location.search).get("puzzle");
			var thinkFourData;
			const firstPuzzle = "2024/04/01";
			var previousPuzzle = firstPuzzle;
			var randomPuzzle, nextPuzzle, lastPuzzle;
			var safeDate;
			var isDeployedSite;

			async function gameStart() {
				try {
					// --- GET PUZZLES AND OTHER DATA ---
					const requestURL = "../files/think-four.json";
					const request = new Request(requestURL);
					const response = await fetch(request);
					thinkFourData = await response.json();

					console.log("%cINFO:", infoStyle, Object.keys(thinkFourData.puzzles).length + " puzzles have been set!");

					const dateObject = new Date();
					let todayYear = dateObject.getFullYear().toString();
					let todayMonth = (dateObject.getMonth() + 1).toString().padStart(2, "0");
					let todayDay = dateObject.getDate().toString().padStart(2, "0");
					date = `${todayYear}/${todayMonth}/${todayDay}`;
					let alternateDate = date;

					let pageURL = window.location.href;

					if (/^\d{4}\/\d{2}\/\d{2}$/.test(dateFromURL)) {
						let alternateYear = parseInt(dateFromURL.substring(0, 4));
						let alternateMonth = parseInt(dateFromURL.substring(5, 7));
						let alternateDay = parseInt(dateFromURL.substring(8, 10));

						let alternateDateObject = new Date(alternateYear, alternateMonth - 1, alternateDay);
						if (alternateDateObject.getTime() <= dateObject.getTime() || (pageURL.includes("public") && !pageURL.includes("&"))) {
							alternateDate = dateFromURL;
						}
					}

					isDeployedSite = !pageURL.includes("public") || (pageURL.includes("public") && pageURL.includes("&"));

					try {
						topics = thinkFourData.puzzles[alternateDate].topics;
						words = thinkFourData.puzzles[alternateDate].words;
						if (date == alternateDate && isDeployedSite) {
							window.history.replaceState(null, "", "think-four");
						}
						date = alternateDate;
					} catch {
						console.log(`%cERROR:`, errorStyle, `no puzzle exists for ${alternateDate}, loading today's`);
						if (isDeployedSite) {
							window.history.replaceState(null, "", "think-four");
						}

						try {
							topics = thinkFourData.puzzles[date].topics;
							words = thinkFourData.puzzles[date].words;
						} catch {
							console.log(`%cERROR:`, errorStyle, `no puzzle exists for today, loading most recent`);

							for (let puzzle in thinkFourData.puzzles) {
								date = puzzle;
								topics = thinkFourData.puzzles[puzzle].topics;
								words = thinkFourData.puzzles[puzzle].words;
							}
						}
					}

					document.querySelector("title").innerHTML = `Think Four | ${date}`;
					topics = topics.split("//");
					words = words.split(/\/{2}|\//);

					document.querySelector("h2").innerHTML = toTextDate(date);

					// --- SHUFFLE THE WORDS ---
					mixedWords = [];
					for (let i = 0; i < words.length; i++) mixedWords[i] = words[i];
					mixedWords = shuffle(mixedWords);

					// --- MAKE BOTH ARRAYS 2D ---
					words = toFourByFourArray(words);
					for (let i = 0; i < 4; i++) words[i].sort();
					mixedWords = toFourByFourArray(mixedWords);

					// --- GET PUZZLES FOR SELECT PUZZLE BUTTONS ---
					// 2. previous
					for (let puzzle in thinkFourData.puzzles) {
						if (puzzle == date) break;
						previousPuzzle = puzzle;
					}

					// 4. next
					var foundToday = false;
					for (let puzzle in thinkFourData.puzzles) {
						if (foundToday) {
							nextPuzzle = puzzle;
							break;
						}
						if (puzzle == date) {
							foundToday = true;
						}
					}

					if (nextPuzzle == undefined) nextPuzzle = date;
					let selectPuzzleYear = parseInt(nextPuzzle.substring(0, 4));
					let selectPuzzleMonth = parseInt(nextPuzzle.substring(5, 7));
					let selectPuzzleDay = parseInt(nextPuzzle.substring(8, 10));

					let todayDateObject = new Date();
					let selectPuzzleDateObject = new Date(selectPuzzleYear, selectPuzzleMonth - 1, selectPuzzleDay);

					if (selectPuzzleDateObject.getTime() > todayDateObject.getTime()) nextPuzzle = date;

					// 5. last
					var lastSetPuzzle;
					for (let puzzle in thinkFourData.puzzles) {
						let selectPuzzleYear = parseInt(puzzle.substring(0, 4));
						let selectPuzzleMonth = parseInt(puzzle.substring(5, 7));
						let selectPuzzleDay = parseInt(puzzle.substring(8, 10));

						let todayDateObject = new Date();
						let selectPuzzleDateObject = new Date(selectPuzzleYear, selectPuzzleMonth - 1, selectPuzzleDay);
						if (selectPuzzleDateObject.getTime() <= todayDateObject.getTime()) lastPuzzle = puzzle;

						lastSetPuzzle = puzzle;
					}

					if (document.querySelectorAll(".last-puzzle-notice").length > 0) {
						document.querySelector(".last-puzzle-notice").innerHTML = toTextDate(lastSetPuzzle);
					}

					// 3. random
					let possibleRandomPuzzleDates = [];
					for (let puzzle in thinkFourData.puzzles) {
						if (date != puzzle) possibleRandomPuzzleDates.push(puzzle);
						if (puzzle == lastPuzzle) break;
					}
					randomPuzzle = possibleRandomPuzzleDates[Math.floor(Math.random() * possibleRandomPuzzleDates.length)];

					// disable same
					if (firstPuzzle == date) document.querySelector(".puzzle-select-buttons span:nth-child(1)").classList.add("disabled");
					if (previousPuzzle == date) document.querySelector(".puzzle-select-buttons span:nth-child(2)").classList.add("disabled");
					if (nextPuzzle == date) document.querySelector(".puzzle-select-buttons span:nth-child(4)").classList.add("disabled");
					if (lastPuzzle == date) document.querySelector(".puzzle-select-buttons span:nth-child(5)").classList.add("disabled");

					safeDate = date.replaceAll("/", "-");
				} catch (error) {
					console.log("%cERROR:", errorStyle, `gameStart() error (are you trying to run locally?)`, error);
				}

				try {
					placeWords(false);
					setTitleWidth();
					await getRating();
					document.querySelector(".loading-container").classList.add("hide");
				} catch {
					console.log("%cERROR:", errorStyle, `could not initialize board, probably because puzzle data could not be loaded`);
				}
			}
			gameStart();

			function setTitleWidth() {
				// attempt at making title appear in a good spot
				if (screenWidth > screenHeight) {
					let titleStyle = `width: ${
						document.querySelector(".board").getBoundingClientRect().left - document.querySelector("h1").getBoundingClientRect().left - 20
					}px`;
					document.querySelector(".titles").style = titleStyle;
				}
			}

			// --- PLACE WORDS, WORD SELECTING ---
			var solved = ["", "", "", ""];
			var boardRect = document.querySelector(".board").getBoundingClientRect();
			var selectedWords = 0;
			var fontSizes = {};

			// getTextNodeHeight, modified to getTextNodeWidth; from https://stackoverflow.com/questions/6961022/measure-bounding-box-of-text-node-in-javascript
			function getTextNodeWidth(textNode) {
				var width = 0;
				if (document.createRange) {
					var range = document.createRange();
					range.selectNodeContents(textNode);
					if (range.getBoundingClientRect) {
						var rect = range.getBoundingClientRect();
						if (rect) {
							width = rect.right - rect.left;
						}
					}
				}
				return width;
			}
			function getTextNodeHeight(textNode) {
				var height = 0;
				if (document.createRange) {
					var range = document.createRange();
					range.selectNodeContents(textNode);
					if (range.getBoundingClientRect) {
						var rect = range.getBoundingClientRect();
						if (rect) {
							height = rect.bottom - rect.top;
						}
					}
				}
				return height;
			}

			function placeWords(resize) {
				document.querySelector(".board").innerHTML = "";

				for (let i = 0; i < 4; i++) {
					if (solved[i] == "") {
						for (let j = 0; j < 4; j++) {
							let wordContainer = document.createElement("div");
							wordContainer.classList.add("word");
							wordContainer.setAttribute("tabindex", 0);

							let gap = (boardRect.width % 100) / 3;
							let w = (boardRect.width + gap) / 4;
							let h = (boardRect.height + gap) / 4;

							let top = boardRect.top + i * h;
							let left = boardRect.left + j * w;

							let x = j;
							let y = i;
							wordContainer.id = `w${x}-${y}`;

							wordContainer.innerHTML = mixedWords[i][j];
							document.querySelector(".board").appendChild(wordContainer);

							if (!fontSizes.hasOwnProperty(mixedWords[i][j])) {
								let fontSize = 36;
								let gW = w - gap;
								let gH = h - gap;

								if (gW == 150 || gW == 100) {
									gW -= 20;
									gH -= 20;
								}
								if (gW == 75) {
									gW -= 10;
									gH -= 10;
								}
								if (gW == 50) {
									gW -= 6;
									gH -= 6;
								}

								do {
									wordContainer.style = `top: ${top}px; left: ${left}px; font-size: ${fontSize}px`;
									fontSizes[mixedWords[i][j]] = fontSize;
									fontSize -= 2;
								} while (getTextNodeWidth(wordContainer.firstChild) > gW || getTextNodeHeight(wordContainer.firstChild) > gH);
							} else {
								wordContainer.style = `top: ${top}px; left: ${left}px; font-size: ${fontSizes[mixedWords[i][j]]}px`;
							}

							wordContainer.addEventListener("click", (e) => {
								if (!wordContainer.classList.contains("disabled")) {
									if (!wordContainer.classList.contains("selected")) {
										if (selectedWords < 4) {
											wordContainer.classList.add("selected");
											selectedWords++;
										}
									} else {
										wordContainer.classList.remove("selected");
										selectedWords--;
									}

									if (selectedWords == 4) document.querySelector(".submit").classList.remove("disabled");
									else document.querySelector(".submit").classList.add("disabled");

									if (selectedWords > 0) document.querySelector(".clear").classList.remove("disabled");
									else document.querySelector(".clear").classList.add("disabled");
								}
							});
						}
					} else {
						let solvedContainer = document.createElement("div");
						solvedContainer.classList.add("solved");
						solvedContainer.classList.add(solved[i]);
						if ((solved[i + 1] == "" || i == 3) && resize == false) solvedContainer.classList.add("new-solve");

						let gap = (boardRect.width % 100) / 3;
						let h = (boardRect.height + gap) / 4;

						let top = boardRect.top + i * h;
						let left = boardRect.left;
						solvedContainer.style = `top: ${top}px; left: ${left}px`;

						let topicNumber = topicColours.indexOf(solved[i]);
						solvedContainer.innerHTML = `<div>${topics[topicNumber]}</div><div>${words[topicNumber][0]}, ${words[topicNumber][1]}, ${words[topicNumber][2]}, ${words[topicNumber][3]}</div>`;
						document.querySelector(".board").appendChild(solvedContainer);
					}
				}
			}

			document.querySelector(".clear").addEventListener("click", (e) => {
				if (!document.querySelector(".clear").classList.contains("disabled")) {
					document.querySelectorAll(".selected").forEach((selected) => {
						selected.classList.remove("selected");
					});
					document.querySelector(".clear").classList.add("disabled");
					document.querySelector(".submit").classList.add("disabled");
					selectedWords = 0;
				}
			});

			// --- SUBMIT SELECTION ---
			var swapX = 0;
			var swapY = 0;
			var guessColours = [];
			const topicColours = ["green", "yellow", "orange", "red"];
			const topicEmojis = ["🟩", "🟨", "🟧", "🟥"];
			var win = false;

			async function topicCheck() {
				let sWA = [];
				document.querySelectorAll(".selected").forEach((selected) => {
					sWA.push(selected.innerHTML);
				});
				sWA.sort();

				for (let i = 0; i < 4; i++) {
					if (sWA[0] == words[i][0] && sWA[1] == words[i][1] && sWA[2] == words[i][2] && sWA[3] == words[i][3]) {
						solved[swapY] = topicColours[i];
						guessColours.push(topicEmojis[i] + topicEmojis[i] + topicEmojis[i] + topicEmojis[i]);

						document.querySelector(".clear").classList.add("disabled");
						document.querySelector(".submit").classList.add("disabled");

						merge();

						if (solved[0] != "" && solved[1] != "" && solved[2] != "" && solved[3] != "") {
							setTimeout(() => {
								win = true;

								document.querySelector(".win-container").classList.remove("hide");
								document.querySelector(".game-container").classList.add("hide");
								document.querySelector(".new-solve").classList.remove("new-solve");

								document.querySelector(".buttons").innerHTML = '<div class="results" tabindex="0">results</div>';

								document.querySelector(".results").addEventListener("click", (e) => {
									document.querySelector(".win-container").classList.remove("hide");
									document.querySelector(".game-container").classList.add("hide");
								});
							}, 2000);

							const db = getDatabase();
							let numberOfSolves;

							await get(ref(db, "think-four/puzzles/" + safeDate)).then((snapshot) => {
								if (snapshot.exists()) {
									numberOfSolves = parseFloat(snapshot.val().solves);
								} else {
									console.log("%cWARNING:", warningStyle, `topicCheck() snapshot does not exist!`);
								}
							});

							if (isNaN(numberOfSolves) || numberOfSolves % 1 != 0 || numberOfSolves < 0) {
								await set(ref(db, "think-four/puzzles/" + safeDate + "/solves"), 0);
								numberOfSolves = 0;
							}

							if (isDeployedSite) await set(ref(db, "think-four/puzzles/" + safeDate + "/solves"), ++numberOfSolves);
						}

						return;
					}
				}

				let thisGuess = "";
				document.querySelectorAll(".selected").forEach((selected) => {
					for (let i = 0; i < 4; i++) {
						if (words[i].includes(selected.innerHTML)) {
							thisGuess += topicEmojis[i];
						}
					}

					selected.classList.add("incorrect");

					document.querySelector(".clear").classList.add("disabled");
					document.querySelector(".submit").classList.add("disabled");
				});
				guessColours.push(thisGuess);

				document.querySelectorAll(".word").forEach((word) => {
					word.classList.add("disabled");
				});

				setTimeout(() => {
					document.querySelectorAll(".selected").forEach((selected) => {
						selected.classList.remove("incorrect");

						document.querySelector(".clear").classList.remove("disabled");
						document.querySelector(".submit").classList.remove("disabled");
					});

					document.querySelectorAll(".word").forEach((word) => {
						word.classList.remove("disabled");
					});
				}, 1000);
			}

			function merge() {
				var samePositionCount = 0;

				document.querySelectorAll(".selected").forEach((selected) => {
					let swapElement = document.querySelector(`#w${swapX++}-${swapY}`);

					let id1 = swapElement.id;
					let id2 = selected.id;

					swapElement.id = id2;
					selected.id = id1;

					let position1 = swapElement.style.cssText;
					let position2 = selected.style.cssText;

					let word1 = swapElement.innerHTML;
					let word2 = selected.innerHTML;

					// did the word swap with itself?
					if (position2.substring(0, position2.indexOf(" font")) == position1.substring(0, position1.indexOf(" font"))) samePositionCount++;

					swapElement.style = position2.substring(0, position2.indexOf(" font")) + position1.substring(position1.indexOf(" font"), position1.length);
					selected.style = position1.substring(0, position1.indexOf(" font")) + position2.substring(position2.indexOf(" font"), position2.length);
				});

				for (let i = 0; i < 4; i++) {
					for (let j = 0; j < 4; j++) {
						try {
							mixedWords[j][i] = document.querySelector(`#w${i}-${j}`).innerHTML;
						} catch {
							mixedWords[j][i] = "";
							console.log(`%cERROR:`, errorStyle, `element #w${i}-${j} does not exist!`);
						}
					}
				}

				swapX = 0;
				swapY++;
				selectedWords = 0;

				let delay = 1500;
				if (samePositionCount == 4) delay = 500; // did none of the words move?

				document.querySelectorAll(".word").forEach((word) => {
					word.removeAttribute("tabindex");
					word.classList.add("disabled");
				});

				setTimeout(() => {
					placeWords(false);

					document.querySelectorAll(".word").forEach((word) => {
						word.classList.remove("disabled");
					});
				}, delay);
			}

			var guesses = 0;
			document.querySelector(".submit").addEventListener("click", (e) => {
				if (!document.querySelector(".submit").classList.contains("disabled")) {
					topicCheck();
					document.querySelector(".win-text span").innerHTML = ++guesses;
					if (guesses == 8) document.querySelector(".win-text span").style = "color: var(--red)";
				}
			});

			// --- PLAY WITH KEYBOARD ---
			var keys = {};

			document.addEventListener("keydown", (e) => {
				keys[e.key] = true;

				if (e.key == "Enter") {
					try {
						if (!document.querySelector(".submit").classList.contains("disabled")) {
							topicCheck();
							document.querySelector(".win-text span").innerHTML = ++guesses;
							if (guesses == 8) document.querySelector(".win-text span").style = "color: var(--red)";
						}
					} catch {
						console.log("%cERROR:", errorStyle, `there is no submit element!`);
					}

					if (document.activeElement == document.querySelector(".loading-help")) {
						window.location.href = "https://discord.gg/yswDu7kywv";
					}

					try {
						if (document.activeElement == document.querySelector(".clear")) {
							if (!document.querySelector(".clear").classList.contains("disabled")) {
								document.querySelectorAll(".selected").forEach((selected) => {
									selected.classList.remove("selected");
								});
								document.querySelector(".clear").classList.add("disabled");
								document.querySelector(".submit").classList.add("disabled");
								selectedWords = 0;
							}
						}
					} catch {
						console.log("%cERROR:", errorStyle, `there is no clear element!`);
					}

					if (document.activeElement == document.querySelector(".results")) {
						document.querySelector(".win-container").classList.remove("hide");
						document.querySelector(".game-container").classList.add("hide");
					}

					if (document.activeElement == document.querySelector(".win-buttons span:nth-child(1)")) {
						let shareText = `Think Four — ${date} — ${guesses} guesses`;
						for (let i = 0; i < guessColours.length; i++) {
							if (i == 16) {
								shareText += "\n...";
								break;
							}
							shareText += "\n" + guessColours[i];
						}
						shareText += "\nhttps://pinniped.page/think-four";
						navigator.clipboard.writeText(shareText);

						document.querySelector(".copy-alert").classList.remove("hide");

						setTimeout(() => {
							document.querySelector(".copy-alert").classList.add("hide");
						}, 2000);
					}
					if (document.activeElement == document.querySelector(".win-buttons span:nth-child(2)")) {
						document.querySelector(".game-container").classList.remove("hide");
						document.querySelector(".win-container").classList.add("hide");
					}
					if (document.activeElement == document.querySelector(".win-buttons span:nth-child(3)")) {
						window.location.href = "../index.html";
					}

					if (document.activeElement == document.querySelector("h3")) {
						window.location.href = "../projects+.html";
					}

					if (document.activeElement == document.querySelector(".puzzle-select-buttons span:nth-child(1)")) {
						if (!document.querySelector(".puzzle-select-buttons span:nth-child(1)").classList.contains("disabled")) {
							window.location.href = "think-four.html?puzzle=" + firstPuzzle;
						}
					}
					if (document.activeElement == document.querySelector(".puzzle-select-buttons span:nth-child(2)")) {
						if (!document.querySelector(".puzzle-select-buttons span:nth-child(2)").classList.contains("disabled")) {
							window.location.href = "think-four.html?puzzle=" + previousPuzzle;
						}
					}
					if (document.activeElement == document.querySelector(".puzzle-select-buttons span:nth-child(3)")) {
						if (!document.querySelector(".puzzle-select-buttons span:nth-child(3)").classList.contains("disabled")) {
							window.location.href = "think-four.html?puzzle=" + randomPuzzle;
						}
					}
					if (document.activeElement == document.querySelector(".puzzle-select-buttons span:nth-child(4)")) {
						if (!document.querySelector(".puzzle-select-buttons span:nth-child(4)").classList.contains("disabled")) {
							window.location.href = "think-four.html?puzzle=" + nextPuzzle;
						}
					}
					if (document.activeElement == document.querySelector(".puzzle-select-buttons span:nth-child(5)")) {
						if (!document.querySelector(".puzzle-select-buttons span:nth-child(5)").classList.contains("disabled")) {
							window.location.href = "think-four.html?puzzle=" + lastPuzzle;
						}
					}

					if (document.activeElement.classList.contains("fa-star")) {
						if (!document.activeElement.classList.contains("disabled")) {
							let starNumber = parseInt(document.activeElement.id.substring(4, 5));
							fillStars(starNumber);
							document.querySelector(".rate-puzzle span:last-child").classList.remove("disabled");
						}
					}

					if (document.activeElement == document.querySelector(".rate-puzzle span:last-child")) {
						if (!document.activeElement.classList.contains("disabled")) {
							submitRating();
						}
					}

					if (document.activeElement == document.querySelector("h4")) {
						window.open("../download.html?x=think-four.pdf");
					}

					if (document.activeElement == document.querySelector(".notice-panel-exit")) {
						document.querySelector(".notice-panel-container").remove();
					}
				}

				if (e.key == "Escape" && win) {
					if (document.querySelector(".win-container").classList.contains("hide")) {
						document.querySelector(".win-container").classList.remove("hide");
						document.querySelector(".game-container").classList.add("hide");
					} else {
						document.querySelector(".game-container").classList.remove("hide");
						document.querySelector(".win-container").classList.add("hide");
					}
				}

				if (e.key == "Escape" && document.querySelectorAll(".notice-panel-container").length != 0) {
					document.querySelector(".notice-panel-container").remove();
				}

				if (e.key == "Backspace") {
					if (!document.querySelector(".clear").classList.contains("disabled")) {
						document.querySelectorAll(".selected").forEach((selected) => {
							selected.classList.remove("selected");
						});
						document.querySelector(".clear").classList.add("disabled");
						document.querySelector(".submit").classList.add("disabled");
						selectedWords = 0;
					}
				}

				if (e.key == " " && document.activeElement.classList.contains("word")) {
					if (!document.activeElement.classList.contains("disabled")) {
						if (!document.activeElement.classList.contains("selected")) {
							if (selectedWords < 4) {
								document.activeElement.classList.add("selected");
								selectedWords++;
							}
						} else {
							document.activeElement.classList.remove("selected");
							selectedWords--;
						}

						if (selectedWords == 4) document.querySelector(".submit").classList.remove("disabled");
						else document.querySelector(".submit").classList.add("disabled");

						if (selectedWords > 0) document.querySelector(".clear").classList.remove("disabled");
						else document.querySelector(".clear").classList.add("disabled");
					}
				}

				if (e.keyCode >= 37 && e.keyCode <= 40) {
					try {
						if (e.keyCode == 37) document.activeElement.previousElementSibling.focus();
						if (e.keyCode == 38) document.activeElement.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.focus();
						if (e.keyCode == 39) document.activeElement.nextElementSibling.focus();
						if (e.keyCode == 40) document.activeElement.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.focus();
					} catch {
						console.log("%cERROR:", errorStyle, `can't go that way!`);
					}
				}
			});

			document.addEventListener("keyup", (e) => {
				delete keys[e.key];
			});

			// --- WIN PANEL & SHARE ---
			const winMessages = [
				"you did it!",
				"yippee!",
				"yay!",
				"incredible!",
				"amazing!",
				"wow!",
				"excellent!",
				"awesome!",
				"super!",
				"fantastic!",
				"wonderful!",
				"bingo!",
				"way to go!",
				"great!",
				"brilliant!",
				"splendid!",
			];
			document.querySelector(".win-title").innerHTML = winMessages[Math.floor(Math.random() * winMessages.length)];

			document.querySelector(".win-buttons span:nth-child(1)").addEventListener("click", (e) => {
				let shareText = `Think Four — ${date} — ${guesses} guesses`;
				for (let i = 0; i < guessColours.length; i++) {
					if (i == 16) {
						shareText += "\n...";
						break;
					}
					shareText += "\n" + guessColours[i];
				}
				shareText += "\nhttps://pinniped.page/think-four";
				navigator.clipboard.writeText(shareText);

				document.querySelector(".copy-alert").classList.remove("hide");

				setTimeout(() => {
					document.querySelector(".copy-alert").classList.add("hide");
				}, 2000);
			});
			document.querySelector(".win-buttons span:nth-child(2)").addEventListener("click", (e) => {
				document.querySelector(".game-container").classList.remove("hide");
				document.querySelector(".win-container").classList.add("hide");
			});
			document.querySelector(".win-buttons span:nth-child(3)").addEventListener("click", (e) => {
				window.location.href = "../index.html";
			});

			// --- EXIT BUTTON ---
			document.querySelector("h3").addEventListener("click", (e) => {
				window.location.href = "../projects+.html";
			});

			// --- PUZZLE SELECT BUTTONS, LIKE MEDIA CONTROLS ---
			document.querySelector(".puzzle-select-buttons span:nth-child(1)").addEventListener("click", (e) => {
				if (!document.querySelector(".puzzle-select-buttons span:nth-child(1)").classList.contains("disabled")) {
					window.location.href = "think-four.html?puzzle=" + firstPuzzle;
				}
			});
			document.querySelector(".puzzle-select-buttons span:nth-child(2)").addEventListener("click", (e) => {
				if (!document.querySelector(".puzzle-select-buttons span:nth-child(2)").classList.contains("disabled")) {
					window.location.href = "think-four.html?puzzle=" + previousPuzzle;
				}
			});
			document.querySelector(".puzzle-select-buttons span:nth-child(3)").addEventListener("click", (e) => {
				if (!document.querySelector(".puzzle-select-buttons span:nth-child(3)").classList.contains("disabled")) {
					window.location.href = "think-four.html?puzzle=" + randomPuzzle;
				}
			});
			document.querySelector(".puzzle-select-buttons span:nth-child(4)").addEventListener("click", (e) => {
				if (!document.querySelector(".puzzle-select-buttons span:nth-child(4)").classList.contains("disabled")) {
					window.location.href = "think-four.html?puzzle=" + nextPuzzle;
				}
			});
			document.querySelector(".puzzle-select-buttons span:nth-child(5)").addEventListener("click", (e) => {
				if (!document.querySelector(".puzzle-select-buttons span:nth-child(5)").classList.contains("disabled")) {
					window.location.href = "think-four.html?puzzle=" + lastPuzzle;
				}
			});

			// --- RATE PUZZLE ---
			//document.querySelector(".win-container").classList.remove("hide");

			document.querySelectorAll(".rate-puzzle div i").forEach((star) => {
				star.addEventListener("click", (e) => {
					if (!star.classList.contains("disabled")) {
						let starNumber = parseInt(star.id.substring(4, 5));
						fillStars(starNumber);
						document.querySelector(".rate-puzzle span:last-child").classList.remove("disabled");
					}
				});
			});

			function fillStars(starNumber) {
				for (let i = 1; i <= 5; i++) {
					let starElement = document.querySelector(`#star${i}`);

					if (i <= starNumber) {
						starElement.classList.remove("fa-regular");
						starElement.classList.add("fa-solid");
					} else {
						starElement.classList.remove("fa-solid");
						starElement.classList.add("fa-regular");
					}
				}
			}

			document.querySelector(".rate-puzzle span:last-child").addEventListener("click", (e) => {
				if (!document.querySelector(".rate-puzzle span:last-child").classList.contains("disabled")) {
					submitRating();
				}
			});

			async function submitRating() {
				document.querySelector(".rate-puzzle span:last-child").innerHTML = "thanks!";
				let rating = 0;
				for (let i = 1; i <= 5; i++) {
					let starElement = document.querySelector(`#star${i}`);
					if (starElement.classList.contains("fa-solid")) rating++;
					starElement.classList.add("disabled");
				}
				document.querySelector(".rate-puzzle span:first-child").classList.add("disabled");
				document.querySelector(".rate-puzzle span:last-child").classList.add("disabled");

				const db = getDatabase();
				let averageRating, numberOfRatings;

				await get(ref(db, "think-four/puzzles/" + safeDate)).then((snapshot) => {
					if (snapshot.exists()) {
						averageRating = parseFloat(snapshot.val().rating);
						numberOfRatings = parseFloat(snapshot.val().ratings);
					} else {
						console.log("%cWARNING:", warningStyle, `submitRating() snapshot does not exist!`);
					}
				});

				if (isNaN(averageRating) || averageRating < 1 || averageRating > 5 || isNaN(numberOfRatings) || numberOfRatings % 1 != 0 || numberOfRatings < 0) {
					await set(ref(db, "think-four/puzzles/" + safeDate + "/rating"), 0);
					await set(ref(db, "think-four/puzzles/" + safeDate + "/ratings"), 0);
					averageRating = 0;
					numberOfRatings = 0;
				}

				averageRating *= numberOfRatings;
				averageRating += rating;
				averageRating /= ++numberOfRatings;
				averageRating = Math.round(averageRating * 100) / 100;

				await set(ref(db, "think-four/puzzles/" + safeDate + "/rating"), averageRating);
				await set(ref(db, "think-four/puzzles/" + safeDate + "/ratings"), numberOfRatings);
			}

			// --- GET PUZZLE RATING ---
			async function getRating() {
				const db = getDatabase();
				let averageRating, numberOfRatings, numberOfSolves;

				await get(ref(db, "think-four/puzzles/" + safeDate)).then((snapshot) => {
					if (snapshot.exists()) {
						averageRating = parseFloat(snapshot.val().rating);
						numberOfRatings = parseFloat(snapshot.val().ratings);
						numberOfSolves = parseFloat(snapshot.val().solves);
					} else {
						console.log("%cWARNING:", warningStyle, `getRating() snapshot does not exist!`);
					}
				});

				if (isNaN(averageRating) || averageRating < 1 || averageRating > 5 || isNaN(numberOfRatings) || numberOfRatings % 1 != 0 || numberOfRatings < 0) {
					await set(ref(db, "think-four/puzzles/" + safeDate + "/rating"), 0);
					await set(ref(db, "think-four/puzzles/" + safeDate + "/ratings"), 0);
					averageRating = 0;
					numberOfRatings = 0;
				}

				if (isNaN(numberOfSolves) || numberOfSolves % 1 != 0 || numberOfSolves < 0) {
					await set(ref(db, "think-four/puzzles/" + safeDate + "/solves"), 0);
					numberOfSolves = 0;
				}

				averageRating = Math.round(averageRating * 2) / 2;

				for (let i = 1; i <= 5; i++) {
					if (averageRating >= 1) {
						document.querySelector(`.puzzle-rating i:nth-child(${i})`).classList.remove("fa-regular");
						document.querySelector(`.puzzle-rating i:nth-child(${i})`).classList.add("fa-solid");
					}
					if (averageRating == 0.5) {
						document.querySelector(`.puzzle-rating i:nth-child(${i})`).classList.remove("fa-star");
						document.querySelector(`.puzzle-rating i:nth-child(${i})`).classList.add("fa-star-half-stroke");
					}
					averageRating--;
				}
			}

			// --- HELP! ---
			document.querySelector("h4").addEventListener("click", (e) => {
				window.open("../download.html?x=think-four.pdf");
			});

			// --- notice panel exit ---
			document.querySelector(".notice-panel-exit").addEventListener("click", (e) => {
				document.querySelector(".notice-panel-container").remove();
			});
		</script>
	</body>
</html>
