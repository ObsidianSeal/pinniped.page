<!DOCTYPE html>

<html lang="en">
	<head>
		<title>BUS DATA</title>

		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="theme-color" content="#4ecdc4" />

		<link rel="icon" href="../images/icon.png" />

		<script src="https://kit.fontawesome.com/c6ef7d4818.js" crossorigin="anonymous"></script>

		<meta property="og:url" content="https://pinniped.page/projects/bus-data" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="BUS DATA" />
		<meta property="og:description" content="Where are London Transit&rsquo;s articulated buses?" />
		<meta property="og:image" content="https://pinniped.page/images/icon.png" />

		<meta name="description" content="Where are London Transit&rsquo;s articulated buses?" />
		<meta name="keywords" content="obsidian_seal, pinniped.page, bus, data, London, London Transit" />

		<style>
			/* FONTS */
			@import url(https://use.typekit.net/rzo4wst.css);

			/* COLOURS */
			:root {
				--base00: #1b2b34;
				--base01: #343d46;
				--base02: #4f5b66;
				--base03: #65737e;
				--base04: #a7adba;
				--base05: #c0c5ce;
				--base06: #cdd3de;
				--base07: #d8dee9;
				--base08: #ec5f67;
				--base09: #f99157;
				--base0A: #fac863;
				--base0B: #99c794;
				--base0C: #5fb3b3;
				--base0D: #6699cc;
				--base0E: #c594c5;
				--base0F: #ab7967;
			}

			/* MAIN STYLES */
			* {
				font-family: "degular";

				margin: 0;
				border: 0;
				padding: 0;

				color: var(--base00);
			}

			body {
				background-color: white;
				padding: 50px;
			}

			h1 {
				font-weight: 700;
				font-size: 120px;
				width: fit-content;

				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			p,
			ul,
			div {
				font-weight: 400;
				font-size: 20px;
			}

			ul {
				margin-left: 35px;
			}

			li:not(li:last-child) {
				margin-bottom: 2px;
			}

			::marker {
				color: var(--base04);
			}

			b {
				font-weight: 700;
				font-size: 40px;
			}

			a {
				text-decoration-style: dashed;
				text-decoration-color: var(--base04);
				text-decoration-skip-ink: none;
			}

			a:hover,
			a:focus {
				text-decoration-color: var(--base09);
			}

			h2 a:hover,
			h2 a:focus {
				text-decoration-color: var(--base0C);
			}

			#to-top-button {
				width: 60px;
				height: 60px;

				font-size: 50px;

				position: fixed;
				right: 50px;
				bottom: 50px;

				display: none;
				align-items: center;
				justify-content: center;

				background-color: var(--base00);
			}

			#to-top-button i {
				color: white;
			}

			#to-top-button:hover {
				cursor: pointer;
				background-color: var(--base08);
			}

			.colours {
				display: flex;
				gap: 20px;
			}

			.colours div {
				width: 20px;
				height: 20px;
			}

			hr {
				border-top: 2px solid var(--base04);
			}

			h2 {
				font-weight: 400;
				font-size: 30px;
			}

			h2 span:not(.grammar, #time-to-update) {
				background-color: var(--base0E);
				color: var(--base00);
				font-weight: 700;
				padding: 0 5px;
			}

			.route {
				display: grid;
				grid-template-columns: 90px auto;
				gap: 20px;
				margin-top: 5px;
			}

			.route:first-child div:first-child {
				color: var(--base00);
			}

			.route div {
				font-size: 20px;
			}

			.route div:first-child {
				text-align: right;
				color: var(--base03);
			}

			.route div:last-child span {
				display: inline-block;
			}

			.route div:last-child span:not(:last-child) {
				transition: width 250ms;
			}

			.route div:last-child span:nth-child(1) {
				background-color: var(--base0D);
			}

			.route div:last-child span:nth-child(2) {
				background-color: var(--base0C);
			}

			.route:first-child div {
				font-weight: 700;
			}

			.hide {
				display: none;
			}

			/* SCROLLBAR(S) */
			::-webkit-scrollbar {
				width: 20px;
			}

			::-webkit-scrollbar-track {
				background-color: var(--base05);
			}

			::-webkit-scrollbar-thumb {
				background-color: var(--base03);
			}

			::-webkit-scrollbar-thumb:hover {
				background-color: var(--base02);
			}

			/* SELECTION */
			::selection {
				background-color: var(--base00);
				color: white;
			}

			/* ANIMATIONS */
			h1 span {
				display: inline-block;
			}

			.dance {
				animation: dance 1s;
			}

			@keyframes dance {
				0% {
					transform: translateY(0);
				}
				50% {
					transform: translateY(-10px);
				}
				100% {
					transform: translateY(0);
				}
			}
		</style>

		<script type="module">
			// big and important variables
			let busDataHeader = {};
			let busData = [];

			// set manually; count from the CPTDB wiki
			const fleet = 227;
			const fleetArticulated = 13;

			// get the data
			async function fetchData() {
				try {
					// make the request, receive the data
					const requestURL = "https://corsproxy.io/?url=http://gtfs.ltconline.ca/Vehicle/VehiclePositions.json";
					const request = new Request(requestURL);
					const response = await fetch(request);
					const responseJSON = await response.json();

					// set the data
					busDataHeader = responseJSON.header;
					busData = responseJSON.entity;
				} catch (error) {
					console.log(error); // hopefully this is not needed
				}
			}
			await fetchData();

			// date
			function updateDate() {
				let busDataDate = new Date(busDataHeader.timestamp * 1000);
				let month = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][busDataDate.getMonth()];
				let day = busDataDate.getDate();
				let ordinal = [
					"st",
					"nd",
					"rd",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"st",
					"nd",
					"rd",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"th",
					"st",
				][busDataDate.getDate()];
				let year = busDataDate.getFullYear();
				let hour = busDataDate.getHours();
				let minute = busDataDate.getMinutes();
				let second = busDataDate.getSeconds();
				document.querySelector("#data-time").innerHTML = `${month} ${day}${ordinal}, ${year} @ ${hour}:${minute.toString().padStart(2, "0")}:${second
					.toString()
					.padStart(2, "0")}`;
			}
			updateDate();

			// where the cool stuff happens
			let firstRun = true;
			function updateBusData() {
				// variables
				let totalBuses = busData.length;
				let articulatedBuses = 0;
				let busDistribution = {
					1: 0,
					2: 0,
					3: 0,
					4: 0,
					5: 0,
					6: 0,
					7: 0,
					9: 0,
					10: 0,
					12: 0,
					13: 0,
					15: 0,
					16: 0,
					17: 0,
					19: 0,
					20: 0,
					24: 0,
					25: 0,
					27: 0,
					28: 0,
					30: 0,
					31: 0,
					33: 0,
					34: 0,
					35: 0,
					36: 0,
					37: 0,
					38: 0,
					90: 0,
					91: 0,
					92: 0,
					93: 0,
					94: 0,
					95: 0,
					102: 0,
					104: 0,
					106: 0,
				};
				let articulatedDistribution = {
					1: 0,
					2: 0,
					3: 0,
					4: 0,
					5: 0,
					6: 0,
					7: 0,
					9: 0,
					10: 0,
					12: 0,
					13: 0,
					15: 0,
					16: 0,
					17: 0,
					19: 0,
					20: 0,
					24: 0,
					25: 0,
					27: 0,
					28: 0,
					30: 0,
					31: 0,
					33: 0,
					34: 0,
					35: 0,
					36: 0,
					37: 0,
					38: 0,
					90: 0,
					91: 0,
					92: 0,
					93: 0,
					94: 0,
					95: 0,
					102: 0,
					104: 0,
					106: 0,
				};

				// create bar graph
				if (firstRun) {
					for (let route in busDistribution) {
						// for each route, create an entry (row)
						let routeEntry = document.createElement("div");
						routeEntry.classList.add("route");

						// create label, 100-series have an asterisk
						let routeNumber = document.createElement("div");
						if (route < 100) routeNumber.innerHTML = `${route.toString().padStart(2, "0")}:`;
						else routeNumber.innerHTML = `${route}*:`;

						// create bars and number
						let busQuantity = document.createElement("div");
						busQuantity.id = `route-${route}`;
						busQuantity.innerHTML = `<span id="non-articulated-${route}">&nbsp;</span><span id="articulated-${route}">&nbsp;</span><span id="value-${route}">&nbsp;# (#)</span>`;

						// add to entry (row)
						routeEntry.appendChild(routeNumber);
						routeEntry.appendChild(busQuantity);

						// add entry (row) to container
						document.querySelector(".route-container").appendChild(routeEntry);
					}

					firstRun = false;
				}

				// iterate through each bus
				for (let i = 0; i < totalBuses; i++) {
					// information to put in the table that is coming soon™
					let busID = parseInt(busData[i].id);
					let routeNumber = parseInt(busData[i].vehicle.trip.route_id);
					let latitude = busData[i].vehicle.position.latitude;
					let longitude = busData[i].vehicle.position.longitude;

					// calculate distributions and count the number of articulated buses
					busDistribution[routeNumber]++;
					if (busID < 100) {
						articulatedBuses++;
						articulatedDistribution[routeNumber]++;
					}
				}

				// show totals
				document.querySelector("#bus-total").innerHTML = `${totalBuses}`;
				document.querySelector("#bus-total-articulated").innerHTML = `${articulatedBuses}`;

				// format percentages
				let totalBusesPercent = new Intl.NumberFormat("en", {
					style: "percent",
					minimumFractionDigits: 2,
					maximumFractionDigits: 2,
				}).format(totalBuses / fleet);

				let articulatedBusesPartialPercent = new Intl.NumberFormat("en", {
					style: "percent",
					minimumFractionDigits: 2,
					maximumFractionDigits: 2,
				}).format(articulatedBuses / totalBuses);

				let articulatedBusesPercent = new Intl.NumberFormat("en", {
					style: "percent",
					minimumFractionDigits: 2,
					maximumFractionDigits: 2,
				}).format(articulatedBuses / fleetArticulated);

				// show percentages
				document.querySelector("#bus-total-percent").innerHTML = totalBusesPercent;
				document.querySelector("#bus-total-articulated-partial-percent").innerHTML = articulatedBusesPartialPercent;
				document.querySelector("#bus-total-articulated-percent").innerHTML = articulatedBusesPercent;

				// DYNAMIC GRAMMAR
				if (articulatedBuses == 0) {
					document.querySelector("#articulated-info").classList.add("hide");
					document.querySelector("#articulated-none").classList.remove("hide");
				} else {
					document.querySelector("#articulated-info").classList.remove("hide");
					document.querySelector("#articulated-none").classList.add("hide");
				}

				if (articulatedBuses == 1) document.querySelector("#articulated-grammar-1").innerHTML = "is";
				else document.querySelector("#articulated-grammar-1").innerHTML = "are";

				if (totalBuses == 0) {
					document.querySelector("#total-info").classList.add("hide");
					document.querySelector("#total-none").classList.remove("hide");
				} else {
					document.querySelector("#total-info").classList.remove("hide");
					document.querySelector("#total-none").classList.add("hide");
				}

				if (totalBuses == 1) {
					document.querySelector("#total-grammar-1").innerHTML = "is";
					document.querySelector("#total-grammar-2").innerHTML = "bus";
				} else {
					document.querySelector("#total-grammar-1").innerHTML = "are";
					document.querySelector("#total-grammar-2").innerHTML = "buses";
				}

				// update bar graph
				if (!firstRun) {
					for (let route in busDistribution) {
						// include a number in parentheses?
						let articulatedIndicator = "";
						if (articulatedDistribution[route] > 0) articulatedIndicator = ` (${articulatedDistribution[route]})`;

						// set values
						document.querySelector(`#non-articulated-${route}`).style = `width: ${(busDistribution[route] - articulatedDistribution[route]) * 50}px`;
						document.querySelector(`#articulated-${route}`).style = `width: ${articulatedDistribution[route] * 50}px`;
						document.querySelector(`#value-${route}`).innerHTML = `&nbsp;${busDistribution[route]}${articulatedIndicator}`;
					}
				}
			}
			updateBusData();

			// automatic update timer
			let timer = 30 - 1;
			setInterval(() => {
				// update, reset at 0
				if (timer == 0) {
					update();
					timer = 30;
				}
				document.querySelector("#time-to-update").innerHTML = timer;

				// DYNAMIC GRAMMAR
				if (timer == 1) document.querySelector("#update-grammar").innerHTML = "";
				else document.querySelector("#update-grammar").innerHTML = "s";

				// tick
				timer--;
			}, 1000);

			// the actual update
			async function update() {
				await fetchData();
				updateDate();
				updateBusData();
			}
		</script>
	</head>

	<body>
		<h1>
			<i class="fa-sharp fa-solid fa-bus"></i> <span>B</span><span>U</span><span>S</span> <span>D</span><span style="translate: -5px 0">A</span
			><span style="translate: -15px 0">T</span><span style="translate: -25px 0">A</span>
		</h1>

		<br />

		<p>v0.0.8 — April 9th, 2025 — <a href="" title="this page (click to refresh)">pinniped.page/projects/bus-data</a></p>

		<p>
			a project by <a href="../about.html" target="_blank" title="pinniped.page — About">Obsidian_Seal</a> — not affiliated with
			<a href="https://londontransit.ca/" target="_blank" title="London Transit&rsquo;s website [EXTERNAL]">London Transit</a>
		</p>

		<br />

		<b>QUICK LINKS</b>
		<ul>
			<li>
				<a
					href="https://realtime.londontransit.ca/#/app/nextdepartures"
					target="_blank"
					title="&ldquo;INFO-Web Transit Information&rdquo; / &ldquo;LTC - Next departures&rdquo; / &ldquo;Real-Time&rdquo; [EXTERNAL]"
					>LTC realtime</a
				>
			</li>
			<li>
				<a href="https://cptdb.ca/wiki/index.php/London_Transit_Commission" target="_blank" title="CPTDB wiki — London Transit Commission [EXTERNAL]"
					>CPTDB wiki — London Transit Commission</a
				>
			</li>
		</ul>

		<br />
		<br />
		<hr />
		<br />
		<br />

		<b>THE DATA</b>
		<h2>
			<a href="http://gtfs.ltconline.ca/Vehicle/VehiclePositions.json" target="_blank" title="LTC Open Data > VehiclePositions.json [FILE; EXTERNAL]"
				>VehiclePositions.json</a
			>
			from
			<span style="background-color: var(--base0C)" id="data-time">???</span>
		</h2>
		<p style="margin-top: 5px; color: var(--base03)">
			automatically updating in <span id="time-to-update" style="color: var(--base03)">30</span> second<span
				class="grammar"
				id="update-grammar"
				style="color: var(--base03)"
				>s</span
			>...
		</p>

		<br />

		<b>BUS TOTALS</b>
		<h2 id="total-info">
			There <span class="grammar" id="total-grammar-1">are</span> <span id="bus-total">#</span> <span class="grammar" id="total-grammar-2">buses</span> in service, making
			up <span id="bus-total-percent">%</span> of London Transit&rsquo;s known fleet.
		</h2>
		<h2 id="total-none" class="hide">London Transit it not currently running any buses.</h2>
		<h2 id="articulated-info">
			<span id="bus-total-articulated">#</span> of those buses <span class="grammar" id="articulated-grammar-1">are</span> articulated,
			<span id="bus-total-articulated-partial-percent">%</span> of in-service buses and <span id="bus-total-articulated-percent">%</span> of London Transit&rsquo;s fleet
			of articulated buses.
		</h2>
		<h2 id="articulated-none" class="hide">None of them are articulated.</h2>

		<br />

		<b>BUS DISTRIBUTION</b>
		<p>
			The number of buses on each route, shown as a bar graph.<br />If a route has at least one articulated bus running on it, the number of said buses is shown next to
			the total and reflected in a separate, teal segment of the corresponding bar.
		</p>
		<br />
		<div class="route-container">
			<div class="route">
				<div>ROUTE NUMBER</div>
				<div><br />BUSES (ARTICULATED, IF ANY)</div>
			</div>
		</div>
		<br />
		<p style="color: var(--base03)">
			*the 100-series (<a href="https://en.wikipedia.org/wiki/Short_turn" target="_blank" style="color: var(--base03)" title="Wikipedia > Short turn [EXTERNAL]"
				>short turn</a
			>) routes only run from September to April (for university/college students)
		</p>

		<br />

		<b>BUS POSITIONS & MODELS</b>
		<p>coming soon&trade;</p>

		<br />
		<br />
		<hr />
		<br />
		<br />

		<b>ATTRIBUTION</b>
		<ul>
			<li>
				bus data from &ldquo;<a href="https://www.londontransit.ca/open-data/" target="_blank" title="Open Data — London Transit Commission [EXTERNAL]"
					>Open Data — London Transit Commission</a
				>&rdquo;
			</li>
			<li>
				additional information from <a href="https://cptdb.ca/wiki/index.php/Main_Page" target="_blank" title="CPTDB wiki [EXTERNAL]">the CPTDB wiki</a>,
				<a href="https://londontransit.ca/" target="_blank" title="London Transit&rsquo;s website [EXTERNAL]">London Transit&rsquo;s website</a>, and &ldquo;<a
					href="https://realtime.londontransit.ca/#/app/nextdepartures"
					target="_blank"
					title="&ldquo;INFO-Web Transit Information&rdquo; / &ldquo;LTC - Next departures&rdquo; / &ldquo;Real-Time&rdquo; [EXTERNAL]"
					>LTC realtime</a
				>&rdquo;
			</li>
			<li>CORS proxy through <a href="https://corsproxy.io/" target="_blank" title="CorsProxy [EXTERNAL]">CorsProxy</a></li>
			<li>
				<a href="https://fonts.adobe.com/fonts/degular" target="_blank" title="Adobe Fonts > Degular [EXTERNAL]">Degular (typeface)</a> by
				<a href="https://ohnotype.co/" target="_blank" title="OH no Type Co. [EXTERNAL]">OH no Type Co.</a> on
				<a href="" target="_blank" title="Adobe Fonts [EXTERNAL]">Adobe Fonts</a>
			</li>
			<li>icons from <a href="https://fontawesome.com/" target="_blank" title="Font Awesome [EXTERNAL]">Font Awesome</a></li>
			<li>
				<a
					href="https://github.com/voronianski/oceanic-next-color-scheme"
					target="_blank"
					title="GitHub > voronianski > &ldquo;oceanic-next-color-scheme&rdquo; [EXTERNAL]"
					>Oceanic Next</a
				>
				colour scheme
			</li>
			<li>and help from some awesome people!</li>
		</ul>

		<br />
		<br />
		<br />

		<div class="colours">
			<div style="background-color: var(--base08)"></div>
			<div style="background-color: var(--base09)"></div>
			<div style="background-color: var(--base0A)"></div>
			<div style="background-color: var(--base0B)"></div>
			<div style="background-color: var(--base0C)"></div>
			<div style="background-color: var(--base0D)"></div>
			<div style="background-color: var(--base0E)"></div>
			<div style="background-color: var(--base0F)"></div>
		</div>

		<div id="to-top-button"><i class="fa-sharp fa-solid fa-arrow-up"></i></div>

		<script>
			// animate the title (make it DANCE!!)
			lastDance = 0;
			document.querySelector("h1").addEventListener("mouseover", () => {
				if (new Date().getTime() - lastDance > 1600) {
					for (let i = 0; i < 7; i++) {
						setTimeout(() => {
							document.querySelector(`h1 span:nth-child(${i + 2})`).classList.add("dance");
						}, 100 * i);
					}
					setTimeout(() => {
						document.querySelectorAll("h1 span").forEach((span) => {
							span.classList.remove("dance");
						});
					}, 1600);
					lastDance = new Date().getTime();
				}
			});

			// show "to-top-button" on scroll
			document.addEventListener("scroll", (e) => {
				if (window.scrollY > 300) document.querySelector("#to-top-button").style = "display: flex";
				else document.querySelector("#to-top-button").style = "display: none";
			});

			// click on "to-top-button"
			document.querySelector("#to-top-button").addEventListener("click", (e) => {
				window.scroll(0, 0);
			});
		</script>
	</body>
</html>
