<!DOCTYPE html>

<html lang="en">
	<head>
		<title>crosswords</title>

		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="theme-color" content="#4ecdc4" />

		<link rel="icon" href="../images/icon.png" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-25..200" />

		<meta property="og:url" content="https://pinniped.page/projects/crosswords" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="crosswords" />
		<meta property="og:description" content="Crossword renderer beta. [description subject to change]" />
		<meta property="og:image" content="https://pinniped.page/images/icon.png" />

		<meta name="description" content="Crossword renderer beta. [description subject to change]" />
		<meta name="keywords" content="crosswords" />

		<style>
			@import url("https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900");

			:root {
				/* Thank you monkeytype (earthsong) */
				--bg: #292521;
				--main: #509452;
				--caret: #1298ba;
				--sub: #f5ae2d;
				--sub-alt: #1d1b18;
				--text: #e6c7a8;
				--error: #7e2a33;
				--error-extra: #ff645a;
			}

			::-webkit-scrollbar {
				width: 20px;
			}

			::-webkit-scrollbar-thumb {
				background-color: var(--main);
				border: 5px solid var(--bg);
			}

			::-webkit-scrollbar-thumb:hover {
				background-color: var(--sub);
			}

			* {
				margin: 0;
				border: 0;
				padding: 0;
				font-family: "Roboto Slab";
			}

			body {
				margin: 20px;
				border: 2px solid var(--main);
				padding: 20px;

				background-color: var(--bg);
				min-height: calc(100vh - 84px);
			}

			h1,
			h2 {
				color: var(--main);
				width: fit-content;
			}

			h1 {
				font-size: 72px;
				font-weight: 700;
				position: relative;
			}

			h2 {
				font-size: 36px;
				font-weight: 500;

				margin-bottom: 50px;
			}

			h2 span {
				color: var(--sub);
			}

			h1::selection,
			h2::selection,
			h2 span::selection,
			.puzzle-title::selection,
			.clues-title::selection,
			.clues div::selection {
				background-color: var(--sub-alt);
			}

			.material-symbols-outlined {
				font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
			}

			.filled {
				font-variation-settings: "FILL" 1, "wght" 400, "GRAD" 0, "opsz" 24;
			}

			h1 .material-symbols-outlined {
				font-size: 72px;
				translate: 0 10px;
			}

			h1 .material-symbols-outlined:hover {
				cursor: pointer;
				color: var(--sub);
			}

			.choose-puzzle-menu {
				width: 500px;
				height: 300px;

				position: absolute;
				top: 100px;

				background-color: var(--bg);
				border: 2px solid var(--sub-alt);
				padding: 0;

				z-index: 1;
				overflow-y: auto;
			}

			.choose-puzzle-menu div {
				font-size: 32px;
				font-weight: 500;
				padding: 0 0 5px 10px;
				color: var(--text);
			}

			.choose-puzzle-menu div:hover {
				cursor: pointer;
				background-color: var(--sub-alt);
			}

			.timer {
				font-size: 32px;
				font-weight: 300;

				position: absolute;
				top: 50px;
				right: 80px;

				width: 110px;
				display: flex;
				justify-content: space-between;

				color: var(--caret);
			}

			.pause-button {
				font-size: 32px;
				translate: 0 7px;
			}

			.pause-button:hover {
				color: var(--sub);
				cursor: pointer;
			}

			.choose-puzzle-menu,
			.material-symbols-outlined,
			.timer,
			.crossword {
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			.crossword-container {
				display: flex;
				justify-content: center;
				gap: 40px;
			}

			.crossword {
				width: fit-content;
			}

			.row {
				display: flex;
				width: fit-content;
			}

			.square {
				width: 50px;
				height: 40px;

				border-top: 2px solid var(--sub-alt);
				border-left: 2px solid var(--sub-alt);

				display: flex;
				align-items: center;
				justify-content: center;

				font-size: 36px;
				font-weight: 500;
				padding-top: 10px;

				color: var(--text);
				background-color: var(--bg);

				position: relative;
			}

			.square:last-child {
				border-right: 2px solid var(--sub-alt);
			}

			.row:last-child .square {
				border-bottom: 2px solid var(--sub-alt);
			}

			.void {
				background-color: var(--sub-alt);
			}

			.square span {
				font-size: 12px;
				font-weight: 300;

				position: absolute;
				top: 0;
				left: 5px;
			}

			.clues-container {
				border: 2px solid var(--sub-alt);
				color: var(--text);
				width: 502px;
				height: fit-content;
				display: flex;
			}

			.across-clues,
			.down-clues {
				width: 50%;
			}

			.across-clues {
				border-right: 2px solid var(--sub-alt);
			}

			.clues-title {
				font-size: 32px;
				font-weight: 500;
				padding: 5px 0 5px 10px;
				border-bottom: 2px solid var(--sub-alt);
			}

			.clues {
				height: 100%;
				overflow: auto;
				max-height: 450px;
				padding: 10px 10px 10px 0;
			}

			.clue {
				margin-bottom: 10px;
				display: grid;
				grid-template-columns: 30px auto;
				gap: 10px;
			}

			.clue div:first-child {
				font-weight: 700;
				text-align: right;
			}

			.show {
				display: initial;
			}

			.hide {
				display: none;
			}
		</style>
	</head>

	<body>
		<h1>
			&ldquo;<span class="puzzle-title"></span>&rdquo; <span class="material-symbols-outlined">arrow_drop_down</span>
			<div class="choose-puzzle-menu hide"></div>
		</h1>
		<h2>by <span></span></h2>
		<div class="timer"><span>0:00</span> <span class="material-symbols-outlined filled pause-button">pause</span></div>

		<div class="crossword-container">
			<div class="crossword"></div>
			<div class="clues-container">
				<div class="across-clues">
					<div class="clues-title">ACROSS</div>
					<div class="clues"></div>
				</div>
				<div class="down-clues">
					<div class="clues-title">DOWN</div>
					<div class="clues"></div>
				</div>
			</div>
		</div>

		<script>
			// --- 0. element constants ---
			const choosePuzzleMenuElement = document.querySelector(".choose-puzzle-menu");
			const menuArrowElement = document.querySelector("h1 .material-symbols-outlined");
			const timerContainerElement = document.querySelector(".timer");
			const timerElement = document.querySelector(".timer span");
			const pauseButtonElement = document.querySelector(".pause-button");
			const acrossCluesContainerElement = document.querySelector(".across-clues .clues");
			const downCluesContainerElement = document.querySelector(".down-clues .clues");

			// --- 1. load crossword & word numbers; set title, subtitle, and menu ---

			const crosswords = [
				[
					"Friday, March 15th, 2024",
					"Obsidian_Seal",
					"H-ARMS--HOLD/E-L-E-H-O-A-/XYLEM-ATTACK/A---E-TO--E-/GRASS-ROUNDS/O-----E--U-E/N-CHILDREN-N/S-H-N--E-SIT/-SENDS-N----/T-A-I--TRAYS/EXTRAS--ITEM/N-S--OXYGENS",
					["not yet written"],
					["not yet written"],
				],
				[
					"Tuesday, March 19th, 2024",
					"Obsidian_Seal",
					"QUEUE/U-M-A/ALTER/IT-ON/LEANS",
					["line up", "", "", "change", "", "", "well-known Stephen King novel", "atop", "the Tower of Pisa does this"],
					["bird", "ambulance employee", "makes money", "", "a standard for wireless data transmission", "very, very long time"],
				],
				["animals", "Obsidian_Seal", "SEAL----/H----R--/ELEPHANT/E----C-U/PIG--C-R/--OX-O-T/--A--O-L/CAT--N-E", ["not yet written"], ["not yet written"]],
				["mini puzzle, big fun", "Obsidian_Seal", "SLATE/PET-A/IDEAS/N---T/EXIT-", ["not yet written"], ["not yet written"]],
				[
					"drowssorc",
					"that queer astrophysicist",
					"ANODE-------------/S------F----YAP---/TRANSFORMER---L---/R--O---O----PLANET/O------GAY--L-Y--H/PROTON------A----U/H-R--ELECTRONS---R/Y-B--U--O-H--PI--S/S----T--R-Y--A---D/ICY--R--E-T--C---A/C-E-SON-Y-HERE---Y/S-E--N----M-I-----/--TWO-------P-----",
					["not yet written"],
					["not yet written"],
				],
			];

			var crosswordNumber = Math.floor(Math.random() * crosswords.length);

			const query = window.location.search;
			const item = new URLSearchParams(query);
			var puzzleNumber = item.get("puzzle");

			if (/^\d+$/.test(puzzleNumber)) {
				puzzleNumber = parseInt(puzzleNumber);
				if (puzzleNumber < crosswords.length) crosswordNumber = parseInt(puzzleNumber);
				else window.location.href = "?puzzle=" + crosswordNumber;
			} else window.location.href = "?puzzle=" + crosswordNumber;

			const crosswordArray = crosswords[crosswordNumber][2].split("/");
			for (let i = 0; i < crosswordArray.length; i++) crosswordArray[i] = crosswordArray[i].split("");

			document.querySelector("h1 span").innerHTML = crosswords[crosswordNumber][0];
			document.querySelector("h2 span").innerHTML = crosswords[crosswordNumber][1];

			for (let i = 0; i < crosswords.length; i++) {
				let puzzleListItemElement = document.createElement("div");
				puzzleListItemElement.innerHTML = crosswords[i][0];
				choosePuzzleMenuElement.appendChild(puzzleListItemElement);

				puzzleListItemElement.addEventListener("click", (e) => {
					window.location.href = "?puzzle=" + i;
				});
			}

			function toggleVisibility(element) {
				if (element.classList.contains("show")) {
					element.classList.remove("show");
					element.classList.add("hide");
					return;
				}
				if (element.classList.contains("hide")) {
					element.classList.remove("hide");
					element.classList.add("show");
					return;
				}
			}

			menuArrowElement.addEventListener("click", (e) => {
				toggleVisibility(choosePuzzleMenuElement);
				if (choosePuzzleMenuElement.classList.contains("show")) menuArrowElement.innerHTML = "arrow_drop_up";
				if (choosePuzzleMenuElement.classList.contains("hide")) menuArrowElement.innerHTML = "arrow_drop_down";
			});

			const menuPositionCheck = setInterval(() => {
				const menuArrowRect = menuArrowElement.getBoundingClientRect();

				if (menuArrowRect.width < 100) {
					if (menuArrowRect.left > 550) choosePuzzleMenuElement.style = "right: 0";
					else choosePuzzleMenuElement.style = `left: ${Math.round(menuArrowRect.left) - 42}px`;
					clearInterval(menuPositionCheck);
				}
			}, 10);

			for (let i = 0; i < crosswordArray.length; i++) {
				let rowElement = document.createElement("div");
				rowElement.classList.add("row");

				for (let j = 0; j < crosswordArray[i].length; j++) {
					let squareElement = document.createElement("div");
					squareElement.classList.add("square");

					let letter = crosswordArray[i][j];
					if (letter == "-") squareElement.classList.add("void");
					else squareElement.innerHTML = letter;

					rowElement.append(squareElement);
				}

				document.querySelector(".crossword").appendChild(rowElement);
			}

			var numberCount = 0;
			for (let i = 0; i < crosswordArray.length; i++) {
				for (let j = 0; j < crosswordArray[i].length; j++) {
					if (crosswordArray[i][j] == "-") continue;

					var upVoid = false;
					var leftVoid = false;
					var downVoid = false;
					var rightVoid = false;

					if (i == 0) upVoid = true;
					else if (crosswordArray[i - 1][j] == "-") upVoid = true;

					if (j == 0) leftVoid = true;
					else if (crosswordArray[i][j - 1] == "-") leftVoid = true;

					if (i == crosswordArray.length - 1) downVoid = true;
					else if (crosswordArray[i + 1][j] == "-") downVoid = true;

					if (j == crosswordArray[i].length - 1) rightVoid = true;
					else if (crosswordArray[i][j + 1] == "-") rightVoid = true;

					if ((leftVoid && !rightVoid) || (upVoid && !downVoid)) {
						let numberElement = document.createElement("span");
						numberElement.innerHTML = ++numberCount;
						document.querySelector(`.row:nth-child(${i + 1}) .square:nth-child(${j + 1})`).appendChild(numberElement);
					}
				}
			}

			function createClueElement(number, text, container) {
				let clueElement = document.createElement("div");
				clueElement.classList.add("clue");

				let numberElement = document.createElement("div");
				numberElement.innerHTML = number;

				let clueTextElement = document.createElement("div");
				clueTextElement.innerHTML = text;

				clueElement.appendChild(numberElement);
				clueElement.appendChild(clueTextElement);

				container.appendChild(clueElement);
			}

			for (let i = 0; i < crosswords[crosswordNumber][3].length; i++) {
				if (crosswords[crosswordNumber][3][i] != "") createClueElement(i + 1, crosswords[crosswordNumber][3][i], acrossCluesContainerElement);
			}

			for (let i = 0; i < crosswords[crosswordNumber][4].length; i++) {
				if (crosswords[crosswordNumber][4][i] != "") createClueElement(i + 1, crosswords[crosswordNumber][4][i], downCluesContainerElement);
			}

			// --- 2. keyboard input ---

			const keys = {};

			document.addEventListener("keydown", (e) => {
				keys[e.key] = true;

				if (e.keyCode >= 65 && e.keyCode <= 90) {
					console.log("type: " + e.key.toUpperCase());
				}

				if (e.key == " ") {
					console.log("space to switch direction!");
				}

				if (e.keyCode >= 37 && e.keyCode <= 40) {
					console.log("arrow keys to change direction and move");
				}

				if (e.key == "Tab" || e.key == "Enter") {
					if (e.key == "Tab") e.preventDefault();
					console.log("tab/enter to next clue (shift tab/enter for back)");
				}

				if (e.key == "Backspace" || e.key == "Delete") {
					console.log("backspace/delete");
				}
			});

			document.addEventListener("keyup", (e) => {
				delete keys[e.key];
			});

			// --- 3. the mouse ---

			document.querySelectorAll(".square:not(.void)").forEach((openSquare) => {
				openSquare.addEventListener("click", (e) => {
					console.log("click to move to (same direction)\nclick current to change direction");
				});
			});

			// --- 4. timer ---

			var minutes = 0;
			var seconds = 0;
			var pad = "";
			var pause = false;

			setInterval(() => {
				if (!pause) {
					seconds++;
					if (seconds == 60) {
						seconds = 0;
						minutes++;

						timerContainerElement.style = `width: ${92 + 18 * minutes.toString().length}px`;
					}
					if (seconds < 10) pad = "0";
					else pad = "";
					timerElement.innerHTML = `${minutes}:${pad}${seconds}`;
				}
			}, 1000);

			// --- 5. pause ---

			pauseButtonElement.addEventListener("click", (e) => {
				pause = true;
				// pause menu with continue button
			});
		</script>
	</body>
</html>
