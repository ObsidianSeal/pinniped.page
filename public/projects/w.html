<!DOCTYPE html>

<html lang="en">
	<head>
		<title>wordlelele</title>

		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="theme-color" content="#4ecdc4" />

		<link rel="icon" href="../images/icon.png" />

		<meta property="og:url" content="https://pinniped.page/projects/w" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="wordlelele" />
		<meta property="og:description" content="Weird Wordle: longer words, choose the next word." />
		<meta property="og:image" content="https://pinniped.page/images/icon.png" />

		<style>
			@import url(https://use.typekit.net/rzo4wst.css);

			/* 
			OLD COLOURS
			:root {
				--c1: #22162b;
				--c2: #451f55;
				--c3: #724e91;
				--c4: #e54f6d;
				--c5: #f8c630;
			} 
			*/

			:root {
				--c1: #252525;
				--c2: #464646;
				--c3: #7d7d7d;
				--c4: #448ccb;
				--c5: #f68e56;
			}

			* {
				margin: 0;
				border: 0;
				padding: 0;
				font-family: "miller-text";
				font-size: 24px;
				font-weight: 400;
			}

			body {
				background-color: var(--c1);
				color: white;
				padding: 120px 0 260px 0;
			}

			h1 span:first-child {
				color: var(--c5);
			}

			h1 span:last-child {
				color: var(--c4);
			}

			h2 {
				font-size: 48px;
				color: var(--c5);
			}

			.question h2 {
				margin: 20px 0 20px 0;
			}

			.done h2 {
				color: var(--c4);
			}

			input {
				color: var(--c1);
				caret-color: var(--c1);
				padding: 0 5px 0 5px;
				width: 440px;
				text-transform: lowercase;
			}

			input:focus {
				outline: none;
			}

			input::placeholder {
				color: var(--c3);
			}

			ul {
				margin-left: 50px;
			}

			li {
				margin-top: 5px;
				width: fit-content;
			}

			li::marker {
				color: var(--c3);
			}

			li span.correct {
				background-color: var(--c4);
			}

			li span.present {
				background-color: var(--c5);
			}

			li span.absent,
			.question p span.absent {
				background-color: var(--c2);
			}

			::selection {
				background-color: var(--c2);
			}

			input::selection {
				color: white;
			}

			::-webkit-scrollbar {
				width: 20px;
			}

			::-webkit-scrollbar-thumb {
				background-color: var(--c2);
			}

			::-webkit-scrollbar-thumb:hover {
				background-color: var(--c3);
			}

			.header,
			.guesses,
			.letters {
				user-select: none;
			}

			.header {
				background-color: var(--c1);
				width: 100%;
				height: 50px;
				display: flex;
				justify-content: center;
				align-items: center;
				border-bottom: 1px solid var(--c2);
				position: fixed;
				top: 0;
			}

			.header p {
				position: fixed;
				text-decoration: underline;
				text-decoration-color: transparent;
				transition: text-decoration-color 0.5s;
			}

			.header p:hover,
			.header p:focus {
				cursor: pointer;
				text-decoration-color: var(--c3);
				outline: none;
			}

			/* the responsiveness of the guess squares SUCKS */
			.guesses {
				padding: 0 10px 0 10px;
			}

			.guesses div {
				display: flex;
				justify-content: center;
				margin-top: 10px;
			}

			.guesses div div {
				width: 50px;
				height: 50px;
				margin: 0 10px 0 0;
				background-color: transparent;
				border: 2px solid var(--c2);
				font-size: 36px;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.guesses div div:last-child {
				margin: 0;
			}

			.letters {
				width: calc(100% - 20px);
				position: fixed;
				bottom: 0;
				padding: 20px 10px 30px 10px;
				background-color: var(--c1);
				border-top: 1px solid var(--c2);
			}

			.letters div {
				display: flex;
				justify-content: center;
				margin-top: 10px;
			}

			.letters div div {
				width: 35px;
				height: 45px;
				margin: 0 10px 0 0;
				background-color: var(--c3);
				border-radius: 3px;
				font-size: 18px;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.letters div div:hover {
				cursor: pointer;
			}

			.letters div:last-child div:first-child,
			.letters div:last-child div:last-child {
				width: 58px;
			}

			.letters div div:last-child {
				margin: 0;
			}

			.question,
			.done {
				position: fixed;
				display: none;
				top: 0;
				width: calc(100% - 100px);
				height: calc(100% - 100px);
				background-color: var(--c1);
				padding: 50px;
				overflow-y: scroll;
			}

			.question p,
			.done p {
				margin-top: 20px;
			}

			.question p:first-child,
			.done p:first-child {
				margin: 0 0 20px 0;
				text-decoration: underline;
				text-decoration-color: transparent;
				transition: text-decoration-color 0.5s;
				user-select: none;
				width: fit-content;
			}

			.question p:first-child:hover,
			.question p:first-child:focus,
			.done p:first-child:hover,
			.done p:first-child:focus {
				text-decoration-color: var(--c3);
				cursor: pointer;
				outline: none;
			}

			.guesses div div.active {
				border-color: var(--c3);
				animation: appear 200ms;
			}

			.guesses div div.correct,
			.letters div div.correct {
				border-color: var(--c4);
				background-color: var(--c4);
			}

			.guesses div div.present,
			.letters div div.present {
				border-color: var(--c5);
				background-color: var(--c5);
			}

			.guesses div div.absent,
			.letters div div.absent {
				border-color: var(--c2);
				background-color: var(--c2);
			}

			.show {
				display: initial;
			}

			.hide {
				display: none;
			}

			.blue {
				color: var(--c4);
			}

			.orange {
				color: var(--c5);
			}

			.grey {
				color: var(--c3);
			}

			#headerExitButton {
				left: 50px;
			}

			#headerQuestionButton {
				right: 50px;
			}

			#← {
				font-size: 30px;
			}

			#nextWordSubmit,
			#shareButton {
				text-decoration: underline;
				text-decoration-color: transparent;
				transition: text-decoration-color 0.5s;
				user-select: none;
				display: inline-block;
			}

			#shareButton.hide {
				display: none;
			}

			#nextWordSubmit:hover,
			#shareButton:hover,
			#nextWordSubmit:focus,
			#shareButton:focus {
				cursor: pointer;
				text-decoration-color: var(--c3);
				outline: none;
			}

			@keyframes appear {
				50% {
					transform: scale(1.1);
				}
			}

			@media all and (max-width: 550px) {
				input {
					width: calc(100% - 10px);
				}

				#headerExitButton {
					left: 20px;
				}

				#headerQuestionButton {
					right: 20px;
				}
			}

			@media all and (max-width: 440px) {
				h2 {
					font-size: 36px;
				}

				#enter {
					font-size: 14px;
				}
			}

			@media all and (max-width: 330px) {
				.question,
				.done {
					width: calc(100% - 40px);
					height: calc(100% - 100px);
					padding: 50px 20px 50px 20px;
				}
			}

			@media all and (max-height: 440px) {
				.letters {
					padding: 0 10px 10px 10px;
				}
			}
		</style>
	</head>

	<body>
		<div class="header">
			<h1>wordle<span>le</span><span>le</span></h1>
			<p id="headerExitButton" tabindex="0">← exit</p>
			<p id="headerQuestionButton" tabindex="0">???</p>
		</div>

		<div class="guesses"></div>

		<div class="letters">
			<div>
				<div id="Q">Q</div>
				<div id="W">W</div>
				<div id="E">E</div>
				<div id="R">R</div>
				<div id="T">T</div>
				<div id="Y">Y</div>
				<div id="U">U</div>
				<div id="I">I</div>
				<div id="O">O</div>
				<div id="P">P</div>
			</div>
			<div>
				<div id="A">A</div>
				<div id="S">S</div>
				<div id="D">D</div>
				<div id="F">F</div>
				<div id="G">G</div>
				<div id="H">H</div>
				<div id="J">J</div>
				<div id="K">K</div>
				<div id="L">L</div>
			</div>
			<div>
				<div id="enter">enter</div>
				<div id="Z">Z</div>
				<div id="X">X</div>
				<div id="C">C</div>
				<div id="V">V</div>
				<div id="B">B</div>
				<div id="N">N</div>
				<div id="M">M</div>
				<div id="←">←</div>
			</div>
		</div>

		<div class="question">
			<p id="questionBackButton" tabindex="0">← back</p>

			<h2>About / How to Play</h2>

			<p>
				wordlelele: it's Wordle, but the word can be anywhere from one to twenty letters long. And because that's not crazy enough, if you successfully figure out what
				the word is, YOU get to choose the next word. Unfortunately, that means there's no guarantee that the word is family friendly or even a word at all, so good
				luck!
			</p>

			<p>The current word was set <span class="absent" id="lastChangedDisplay">? days ? hours ? minutes ? seconds</span> ago.</p>

			<p>
				However long the word is, you get one more guess than there are letters in the word. To make a guess, use either the provided on-screen keyboard or your own to
				enter an appropriately long word (or random string of letters—I won't stop you), then press enter. The letters that make up your guess are then coloured based
				on their presence in the target word as follows:
			</p>

			<ul>
				<li><span class="correct">&nbsp;BLUE&nbsp;</span> = correct!</li>
				<li><span class="present">&nbsp;ORANGE&nbsp;</span> = in the target word, but elsewhere</li>
				<li><span class="absent">&nbsp;GREY&nbsp;</span> = not in the target word</li>
			</ul>

			<p>
				If you successfully determine the word within the alloted number of guesses, congratulations! You can choose the next word and/or flex your luck and/or skill
				with the share button (it copies text to your clipboard). If you can't get the word, don't fret: you can just reload the page and try again.
			</p>

			<h2>Frequently Asked Questions</h2>

			<ul>
				<li>Why isn't the guess grid showing up?<br /><span class="grey">Either your internet is slow or there's something wrong with the database.</span></li>
				<li>
					Why are the guess grid squares all squished together?<br /><span class="grey"
						>Because...I can't seem to control them. For words longer than five or six letters you may want to play on a bigger screen. Sorry.</span
					>
				</li>
				<li>Why can't I make &lt;invalid word&gt; the next word?<br /><span class="grey">Because words consist exclusively of letters.</span></li>
				<li>
					What do you mean by "the word in the database was invalid"?<br /><span class="grey"
						>Somehow the word contains a character that is not a letter. Hopefully this never happens.</span
					>
				</li>
			</ul>
		</div>

		<div class="done">
			<p id="doneActionButton" tabindex="0">done_action</p>

			<h2>done_message_title</h2>

			<p>done_message_subtitle</p>

			<p>
				Choose the next word: <input id="nextWordInput" maxlength="20" placeholder="new 1-20 letter word" autocomplete="off" />
				<span id="nextWordSubmit" tabindex="0">SUBMIT →</span>
			</p>

			<p id="nextWordStatus" class="hide"></p>

			<p id="shareButton" tabindex="0" class="hide">SHARE →</p>

			<p id="shareButtonStatus" class="blue hide">Copied!</p>
		</div>

		<script type="module">
			// 0. fireBASED
			import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
			import { getDatabase, ref, set, get, child, onValue } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-database.js";

			const firebaseConfig = {
				apiKey: "AIzaSyAigBAgn7Uhybip_m3P508DIpybb2qdI5g",
				authDomain: "the-pinniped-page.firebaseapp.com",
				databaseURL: "https://the-pinniped-page.firebaseio.com",
				projectId: "the-pinniped-page",
				storageBucket: "the-pinniped-page.appspot.com",
				messagingSenderId: "636989973689",
				appId: "1:636989973689:web:6d938d9588606d803a6768",
			};
			const app = initializeApp(firebaseConfig);

			// 1: header & other "back" buttons
			function goBack() {
				if (document.referrer.includes("pinniped.page")) history.back();
				else window.location.href = "../projects+.html";
			}

			document.querySelector("#headerExitButton").addEventListener("click", (e) => {
				goBack();
			});
			document.querySelector("#headerQuestionButton").addEventListener("click", (e) => {
				document.querySelector(".question").classList.add("show");
			});

			document.querySelector("#questionBackButton").addEventListener("click", (e) => {
				document.querySelector(".question").classList.remove("show");
			});

			// 2: guesses
			var word;
			var lastUpdated;
			var invalidWord = false;
			var letters = {
				A: 0,
				B: 0,
				C: 0,
				D: 0,
				E: 0,
				F: 0,
				G: 0,
				H: 0,
				I: 0,
				J: 0,
				K: 0,
				L: 0,
				M: 0,
				N: 0,
				O: 0,
				P: 0,
				Q: 0,
				R: 0,
				S: 0,
				T: 0,
				U: 0,
				V: 0,
				W: 0,
				X: 0,
				Y: 0,
				Z: 0,
			};

			async function loadWord() {
				const db = getDatabase();

				await get(ref(db, "wordlelele")).then((snapshot) => {
					word = snapshot.val().word.toUpperCase();
					lastUpdated = snapshot.val().lastUpdated;
				});

				if (!/^[a-zA-Z]{1,20}$/.test(word)) {
					word = "X";
					invalidWord = true;
				}

				for (let i = 0; i < word.length; i++) {
					letters[word[i]]++;
				}

				// are the right number of attempts given? (word length + 1, also used in the title (x2))
				for (let i = 0; i < word.length + 1; i++) {
					let row = document.createElement("div");
					row.setAttribute("id", `row${i}`);

					for (let j = 0; j < word.length; j++) {
						let square = document.createElement("div");
						square.setAttribute("id", `row${i}square${j}`);
						row.appendChild(square);
					}

					document.querySelector(".guesses").appendChild(row);
				}

				document.querySelector("title").innerHTML = `wordlelele (1/${word.length + 1})`;

				document.querySelectorAll(".letters div div").forEach((button) => {
					button.addEventListener("click", (e) => {
						letterInput(button.innerHTML);
					});
				});

				var keys = {};

				document.addEventListener("keydown", (e) => {
					keys[e.key] = true;

					if (keys["Control"] === true) return; // prevent letters showing up when shortcuts used, there are probably more keys like this

					if (e.keyCode == 13) {
						if (document.activeElement == document.querySelector("#headerExitButton")) goBack();
						else if (document.activeElement == document.querySelector("#headerQuestionButton")) document.querySelector(".question").classList.add("show");
						else if (document.activeElement == document.querySelector("#questionBackButton")) document.querySelector(".question").classList.remove("show");
						else letterInput("enter");
					}
					if (e.keyCode == 8) letterInput("←");
					if (e.keyCode >= 65 && e.keyCode <= 90) {
						letterInput(e.key.toUpperCase());
					}
				});

				document.addEventListener("keyup", (e) => {
					delete keys[e.key];
				});

				// will this cause problems?
				window.addEventListener("focus", (e) => {
					keys = {};
				});
			}
			loadWord();

			// 3: letters
			var positionRow = 0;
			var positionSquare = 0;
			var done = false;
			var win = false;

			function letterInput(value) {
				if (!done) {
					if (value == "enter") {
						if (positionSquare == word.length) {
							let lettersArray = [];
							let squares = [];
							let keyboardElements = [];
							let lettersColoured = {
								A: 0,
								B: 0,
								C: 0,
								D: 0,
								E: 0,
								F: 0,
								G: 0,
								H: 0,
								I: 0,
								J: 0,
								K: 0,
								L: 0,
								M: 0,
								N: 0,
								O: 0,
								P: 0,
								Q: 0,
								R: 0,
								S: 0,
								T: 0,
								U: 0,
								V: 0,
								W: 0,
								X: 0,
								Y: 0,
								Z: 0,
							};

							// (1) get letters
							for (let i = 0; i < word.length; i++) {
								squares[i] = document.querySelector(`#row${positionRow}square${i}`);
								squares[i].classList.remove("active");
								lettersArray.push(squares[i].innerHTML);

								keyboardElements[i] = document.querySelector(`#${lettersArray[i]}`);
							}

							// (2) CORRECT
							for (let i = 0; i < word.length; i++) {
								if (lettersArray[i] == word[i]) {
									squares[i].classList.add("correct");
									if (keyboardElements[i].classList.contains("present")) keyboardElements[i].classList.remove("present");
									keyboardElements[i].classList.add("correct");

									lettersColoured[lettersArray[i]]++;
								}
							}

							// (3) PRESENT
							for (let i = 0; i < word.length; i++) {
								if (word.includes(lettersArray[i])) {
									if (letters[lettersArray[i]] > lettersColoured[lettersArray[i]]) {
										if (squares[i].classList.length == 0) {
											squares[i].classList.add("present");
											lettersColoured[lettersArray[i]]++;
										}
										if (!keyboardElements[i].classList.contains("correct")) keyboardElements[i].classList.add("present");
									} else {
										if (squares[i].classList.length == 0) squares[i].classList.add("absent");

										lettersColoured[lettersArray[i]]++;
									}
								}
							}

							// (4) ABSENT
							for (let i = 0; i < word.length; i++) {
								if (!word.includes(lettersArray[i])) {
									squares[i].classList.add("absent");
									keyboardElements[i].classList.add("absent");

									lettersColoured[lettersArray[i]]++;
								}
							}

							if (lettersArray.join("") == word || positionRow == word.length) {
								done = true;
								if (lettersArray.join("") == word) {
									win = true;
									if (invalidWord) {
										end(true);
										document.querySelector("title").innerHTML = `wordlelele (?!)`;
									} else {
										end(true);
										document.querySelector("title").innerHTML = `wordlelele (success)`;
									}
								} else {
									if (invalidWord) {
										end(true);
										document.querySelector("title").innerHTML = `wordlelele (?!)`;
									} else {
										end(false);
										document.querySelector("title").innerHTML = `wordlelele (fail)`;
									}
								}
							} else {
								document.querySelector("title").innerHTML = `wordlelele (${positionRow + 2}/${word.length + 1})`;
							}

							positionRow++;
							positionSquare = 0;
						}
					} else if (value == "←") {
						if (positionSquare > 0) {
							let element = document.querySelector(`#row${positionRow}square${positionSquare - 1}`);
							element.innerHTML = "";
							element.classList.remove("active");
							positionSquare--;
						}
					} else {
						if (positionSquare < word.length) {
							let element = document.querySelector(`#row${positionRow}square${positionSquare}`);
							element.innerHTML = value;
							element.classList.add("active");
							positionSquare++;
						}
					}
				}
			}

			// 4: win / lose (set next word / you dumb)
			function end(win) {
				if (win) {
					document.querySelector(".done p:first-child").innerHTML = "← back";
					if (!invalidWord) {
						document.querySelector(".done h2").innerHTML = "Congratulations!";
						document.querySelector(".done p:nth-child(3)").innerHTML = "You did it.";
						document.querySelector("#shareButton").classList.remove("hide");
					} else {
						document.querySelector(".done h2").innerHTML = "Sorry, the word in the database was invalid.";
						document.querySelector(".done p:nth-child(3)").innerHTML = "Please change the word to something acceptable.";
					}

					document.querySelector(".done p:first-child").addEventListener("click", (e) => {
						document.querySelector(".done").classList.remove("show");
					});
					document.querySelector("#nextWordSubmit").addEventListener("click", (e) => {
						setNextWord(document.querySelector("input").value.toLowerCase());
					});
					document.querySelector("#shareButton").addEventListener("click", (e) => {
						share();
					});
					document.addEventListener("keydown", (e) => {
						if (e.keyCode == 13) {
							if (document.activeElement == document.querySelector("#doneActionButton")) {
								document.querySelector(".done").classList.remove("show");
							}
							if (document.activeElement == document.querySelector("#nextWordInput") || document.activeElement == document.querySelector("#nextWordSubmit")) {
								setNextWord(document.querySelector("input").value.toLowerCase());
							}
							if (document.activeElement == document.querySelector("#shareButton")) {
								share();
							}
						}
					});
				} else {
					document.querySelector(".done p:first-child").innerHTML = "← back";
					document.querySelector(".done h2").innerHTML = ":(";
					document.querySelector(".done p:nth-child(3)").innerHTML = `Better luck next time.<br />The word was "${word.toLowerCase()}"`;
					document.querySelector("#shareButton").classList.remove("hide");

					document.querySelector(".done p:first-child").addEventListener("click", (e) => {
						document.querySelector(".done").classList.remove("show");
					});
					document.querySelector("#nextWordSubmit").addEventListener("click", (e) => {
						setNextWord(document.querySelector("input").value.toLowerCase());
					});
					document.querySelector("#shareButton").addEventListener("click", (e) => {
						share();
					});
					document.addEventListener("keydown", (e) => {
						if (e.keyCode == 13) {
							if (document.activeElement == document.querySelector("#doneActionButton")) {
								document.querySelector(".done").classList.remove("show");
							}
							if (document.activeElement == document.querySelector("#nextWordInput") || document.activeElement == document.querySelector("#nextWordSubmit")) {
								setNextWord(document.querySelector("input").value.toLowerCase());
							}
							if (document.activeElement == document.querySelector("#shareButton")) {
								share();
							}
						}
					});
				}

				setTimeout(() => {
					document.querySelector(".done").classList.add("show");
					document.querySelector("#nextWordInput").focus();
				}, 2000);
			}

			// 5. set next word in database
			async function setNextWord(word) {
				word = word.replaceAll(" ", "");
				const db = getDatabase();

				if (/^[a-zA-Z]{1,20}$/.test(word)) {
					await set(ref(db, "wordlelele/lastUpdated"), Date.now());
					await set(ref(db, "wordlelele/word"), word);

					document.querySelector("#nextWordStatus").classList.remove("hide");
					document.querySelector("#nextWordStatus").classList.remove("orange");
					document.querySelector("#nextWordStatus").classList.add("blue");
					document.querySelector("#nextWordStatus").innerHTML = `Successfully set the next word to "${word}"`;
				} else {
					document.querySelector("#nextWordStatus").classList.remove("hide");
					document.querySelector("#nextWordStatus").classList.remove("blue");
					document.querySelector("#nextWordStatus").classList.add("orange");
					document.querySelector("#nextWordStatus").innerHTML = `ERROR: invalid word`;
				}
			}

			// 6. share (copy to clipboard)
			function share() {
				var guesses = "";
				document.querySelectorAll(".guesses div div").forEach((letter) => {
					if (letter.innerHTML != "") {
						if (letter.id.substring(letter.id.length - 1) == 0 && letter.id.substring(letter.id.length - 2, letter.id.length - 1) != 1) guesses += "\n";
						if (letter.classList.contains("correct")) guesses += "🟦";
						if (letter.classList.contains("present")) guesses += "🟧";
						if (letter.classList.contains("absent")) guesses += "⬛";
					}
				});
				var finalMessage;
				if (win) finalMessage = `wordlelele — ${word} in ${positionRow}${guesses}\nhttps://pinniped.page/w`;
				else finalMessage = `wordlelele — ${word} in N/A${guesses}\nhttps://pinniped.page/w`;
				navigator.clipboard.writeText(finalMessage);

				document.querySelector("#shareButtonStatus").classList.remove("hide");
				setTimeout(() => {
					document.querySelector("#shareButtonStatus").classList.add("hide");
				}, 4000);
			}

			// 7. update lastChangedDisplay
			setInterval(() => {
				var days = 0;
				var hours = 0;
				var minutes = 0;
				var seconds = 0;

				var daysWord = "days";
				var hoursWord = "hours";
				var minutesWord = "minutes";
				var secondsWord = "seconds";

				let timeElapsed = Math.floor((Date.now() - lastUpdated) / 1000);

				days = Math.floor(timeElapsed / (60 * 60 * 24));
				timeElapsed -= days * (60 * 60 * 24);

				hours = Math.floor(timeElapsed / (60 * 60));
				timeElapsed -= hours * (60 * 60);

				minutes = Math.floor(timeElapsed / 60);
				timeElapsed -= minutes * 60;

				seconds = timeElapsed;

				if (days == 1) daysWord = "day";
				if (hours == 1) hoursWord = "hour";
				if (minutes == 1) minutesWord = "minute";
				if (seconds == 1) secondsWord = "second";

				document.querySelector(
					"#lastChangedDisplay"
				).innerHTML = `&nbsp;${days} ${daysWord} ${hours} ${hoursWord} ${minutes} ${minutesWord} ${seconds} ${secondsWord}&nbsp;`;
			}, 1000);
		</script>
	</body>
</html>
