<!DOCTYPE html>

<html lang="en">
	<head>
		<title>Finite Craft</title>

		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="theme-color" content="#4ecdc4" />

		<link rel="icon" href="../images/icon.png" />

		<meta property="og:url" content="https://pinniped.page/projects/craft" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="Finite Craft" />
		<meta property="og:description" content="Infinite Craft, but just the crafting part." />
		<meta property="og:image" content="https://pinniped.page/images/icon.png" />

		<meta name="description" content="Infinite Craft, but just the crafting part." />
		<meta name="keywords" content="craft" />

		<style>
			/* FONTS FROM GOOGLE FONTS */
			@import url("https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700");

			/* THEME */
			:root {
				--c1: #fdfcdc;
				--c2: #fed9b7;
				--c3: #f07167;
				--c4: #0081a7;
				--c5: #00afb9;
				--c6: #ffffff;
				--c7: #000000;

				--c3o60: #f0716760;
			}

			/* ALL THINGS */
			* {
				margin: 0;
				border: 0;
				padding: 0;
				font-family: "Space Grotesk";
				font-size: 20px;
				user-select: none;
			}

			/* COLOUR & BACKGROUND CLASSES */
			.c1 {
				color: var(--c1);
			}

			.c2 {
				color: var(--c2);
			}

			.c3 {
				color: var(--c3);
			}

			.c4 {
				color: var(--c4);
			}

			.c5 {
				color: var(--c5);
			}

			.c6 {
				color: var(--c6);
			}

			.c7 {
				color: var(--c7);
			}

			.b1 {
				background-color: var(--c1);
			}

			.b2 {
				background-color: var(--c2);
			}

			.b3 {
				background-color: var(--c3);
			}

			.b4 {
				background-color: var(--c4);
			}

			.b5 {
				background-color: var(--c5);
			}

			.b6 {
				background-color: var(--c6);
			}

			.b7 {
				background-color: var(--c7);
			}

			/* ACTUAL CSS*/
			.item {
				position: absolute;
				padding: 3px 7px 7px 7px;
				border: 1px solid var(--c3);
				border-radius: 5px;
			}

			.item:hover {
				cursor: pointer;
				background-image: linear-gradient(var(--c2), var(--c3o60));
			}
		</style>
	</head>

	<body class="b1">
		<div class="item-container"></div>

		<script>
			// --- DRAG & DROP ---
			var drag = false; // dragging currently?
			var dragElement; // what to drag?
			var dragOffsetX = 0;
			var dragOffsetY = 0;

			document.addEventListener("mousedown", (e) => {
				if (e.target.classList.contains("item")) {
					drag = true; // start dragging
					dragElement = e.target; // set dragElement to element clicked
					dragOffsetX = e.offsetX;
					dragOffsetY = e.offsetY;
					document.querySelector(".item:last-child").after(dragElement); // move element to top!
				}
			});

			document.addEventListener("mousemove", (e) => {
				if (drag) {
					var x = e.pageX;
					var y = e.pageY;
					dragElement.style = `left: ${x - dragOffsetX}px; top: ${y - dragOffsetY}px`; // set x and y coordinate of element
				}
			});

			document.addEventListener("mouseup", (e) => {
				if (drag) {
					drag = false; // stop dragging

					// check for overlap --> craft!
					checkForOverlap();
				}
			});

			function checkForOverlap() {
				var combinationsFound = [];

				document.querySelectorAll(".item").forEach((item) => {
					var item1 = dragElement.innerHTML;
					var item2 = item.innerHTML;

					if (item1 != item2) {
						var rect1 = item.getBoundingClientRect();
						var rect2 = dragElement.getBoundingClientRect();

						var overlap = !(rect1.right < rect2.left || rect1.left > rect2.right || rect1.bottom < rect2.top || rect1.top > rect2.bottom);
						if (overlap) {
							let centres = [];
							centres.push(dragElement.offsetLeft + dragElement.offsetWidth / 2);
							centres.push(dragElement.offsetLeft + dragElement.offsetWidth / 2);
							centres.push(item.offsetLeft + item.offsetWidth / 2);
							centres.push(item.offsetLeft + item.offsetWidth / 2);

							let midpointX = centres[0] + (centres[0] - centres[2]);
							let midpointY = centres[1] + (centres[1] - centres[3]);
							// !!!

							combinationsFound.push([item1, item2, dragElement, item, midpointX, midpointY]);
						}
					}
				});

				if (combinationsFound.length > 0) {
					combineItems(combinationsFound[combinationsFound.length - 1]);
				}
			}

			// --- CRAFTING ---
			const combinations = {
				"üí° idea": [
					["üíß liquid", "üí¶ wet"],
					["üìï book", "‚úíÔ∏è writing"],
					["ü¶≠ seal", "üê¢ animal"],
				],
				"üí´ opposite": [
					["‚ù§Ô∏è love", "üò° hate"],
					["‚úíÔ∏è writing", "üìñ reading"],
					["üí¶ wet", "üèúÔ∏è dry"],
				],
				"‚ù§Ô∏è love": [],
				"üìï book": [],
				"üòé cool": [],
				"üñ•Ô∏è computer": [],
				"ü™® solid": [],
				"üíß liquid": [["üòé cool", "üåä water"]],
				"üí≠ gas": [],
				"ü¶≠ seal": [],
				"üí¶ wet": [],
				"‚úíÔ∏è writing": [],
				"üê¢ animal": [],
				"üò° hate": [],
				"üìñ reading": [],
				"üèúÔ∏è dry": [],
				"üå°Ô∏è hot": [
					["ü™® solid", "üíß liquid"],
					["üíß liquid", "üí≠ gas"],
					["üê¢ animal", "üêï dog"],
				],
				"üêï dog": [["üåä water", "ü¶≠ seal"]],
				"üåä water": [],
			};

			function combineItems(items) {
				var alreadyCombined = false;

				combinations[items[0]].forEach((combination) => {
					if (combination[0] == items[1]) {
						alreadyCombined = true;
						placeItem(items[2], items[3], combination[1], items[4], items[5]);
					}
				});

				if (!alreadyCombined) {
					combinations[items[1]].forEach((combination) => {
						if (combination[0] == items[0]) {
							placeItem(items[2], items[3], combination[1], items[4], items[5]);
						}
					});
				}
			}

			function placeItem(element1, element2, item, x, y) {
				// create and append new item element
				let newItemElement = document.createElement("div");
				newItemElement.classList.add("item");
				newItemElement.classList.add("b2");
				newItemElement.innerHTML = item;
				console.log(newItemElement.offsetHeight, newItemElement.offsetHeight); // !
				newItemElement.style = `left: ${x}px; top: ${y}px`;
				document.querySelector(".item-container").appendChild(newItemElement);

				// remove ingredients
				if (element1 != null && element2 != null) {
					element1.remove();
					element2.remove();
				}
			}

			// --- temporary: RANDOM ITEM PLACEMENTS ---
			placeItem(null, null, "üå°Ô∏è hot", Math.floor(Math.random() * 500), Math.floor(Math.random() * 500));
			placeItem(null, null, "ü™® solid", Math.floor(Math.random() * 500), Math.floor(Math.random() * 500));
			placeItem(null, null, "üíß liquid", Math.floor(Math.random() * 500), Math.floor(Math.random() * 500));
			placeItem(null, null, "üí≠ gas", Math.floor(Math.random() * 500), Math.floor(Math.random() * 500));
			placeItem(null, null, "ü¶≠ seal", Math.floor(Math.random() * 500), Math.floor(Math.random() * 500));
			placeItem(null, null, "üí° idea", Math.floor(Math.random() * 500), Math.floor(Math.random() * 500));
		</script>
	</body>
</html>
