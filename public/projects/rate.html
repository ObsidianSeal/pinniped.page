<!DOCTYPE html>

<html lang="en">
	<head>
		<title>10/10 would recommend</title>

		<meta charset="UTF-8" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<meta name="theme-color" content="#4ecdc4" />

		<link rel="icon" href="../images/icon.png" />

		<script src="https://kit.fontawesome.com/c6ef7d4818.js" crossorigin="anonymous"></script>

		<meta property="og:url" content="https://pinniped.page/projects/rate" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="10/10 would recommend" />
		<meta property="og:description" content="Rate anything out of five stars." />
		<meta property="og:image" content="https://pinniped.page/images/icon.png" />

		<style>
			@import url("https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300");

			body {
				background-color: #a6c48a;

				margin: 0;
				border: 0;
				padding: 50px;

				user-select: none;
			}

			p {
				font-family: "Roboto Slab";
				font-size: 20px;
				color: #678d58;

				margin: 0;
				border: 0;
				padding: 0;
			}

			p:first-child:hover {
				cursor: pointer;
			}

			span {
				background-color: #678d58;
				opacity: 0%;
				animation: pulse-fade 2s infinite 0.5s ease-in-out;
			}

			i:hover {
				cursor: pointer;
			}

			.rating-container {
				background-color: #f6e7cb;

				margin: 0 auto 25px auto;
				padding: 10px 20px 10px 20px;
				max-width: 600px;

				display: flex;
				justify-content: space-between;
			}

			.buttons {
				background-color: #f6e7cb;

				border-radius: 40px;
				padding: 15px;
				width: fit-content;
			}

			.buttons i {
				color: #dd9787;
				font-size: 50px;
			}

			.buttons i:hover {
				color: #74d3ae;
			}

			@keyframes pulse-fade {
				0% {
					opacity: 0%;
				}
				50% {
					opacity: 100%;
				}
				100% {
					opacity: 0%;
				}
			}

			::-webkit-scrollbar {
				width: 25px;
			}

			::-webkit-scrollbar-thumb {
				background-color: #dd9787;
				border: 5px solid #f6e7cb;
				border-radius: 50px;
			}

			::-webkit-scrollbar-thumb:hover {
				background-color: #74d3ae;
			}

			::-webkit-scrollbar-track {
				background-color: #f6e7cb;
			}

			@media all and (max-width: 700px) {
				.rating-container {
					display: block;
				}

				p:first-child {
					margin-bottom: 10px;
				}
			}

			form {
				position: fixed;
				top: 5px;
				user-select: none;
			}

			input {
				margin: 0;
				border: 0;
				padding: 0;

				outline: none;
				user-select: none;

				background-color: transparent;
				caret-color: transparent;
				color: transparent;
			}

			input:hover {
				cursor: default;
			}
		</style>
	</head>

	<body>
		<form name="inputForm" id="inputForm">
			<input name="inputBox" id="inputBox" autocomplete="off" spellcheck="false" />
		</form>

		<div id="buttons" style="display: flex; justify-content: center">
			<div class="buttons" style="margin-right: 50px">
				<i id="button-plus" class="fa-solid fa-circle-plus"></i>
			</div>

			<div class="buttons">
				<i id="button-minus" class="fa-solid fa-circle-minus"></i>
			</div>
		</div>

		<script>
			const body = document.querySelector("body");
			const end = document.getElementById("buttons");

			var numberOfRatings = 0;
			var editing = -1;
			var pEditing = -1;
			// var textArray = [];
			var pText;
			var justEscaped = false;
			var specialEdit = false;

			var string = "";
			var pString = "";
			var lastGoodString;

			const keys = {};
			// const allowedKeys = [
			// 	" ",
			// 	"`",
			// 	"~",
			// 	"!",
			// 	"@",
			// 	"#",
			// 	"$",
			// 	"%",
			// 	"^",
			// 	"&",
			// 	"*",
			// 	"(",
			// 	")",
			// 	"-",
			// 	"_",
			// 	"=",
			// 	"+",
			// 	"[",
			// 	"{",
			// 	"]",
			// 	"}",
			// 	"\\",
			// 	"|",
			// 	";",
			// 	":",
			// 	"'",
			// 	'"',
			// 	",",
			// 	".",
			// 	"/",
			// 	"?",
			// ];

			function addRating() {
				if (numberOfRatings < 19) {
					const container = document.createElement("div");
					container.setAttribute("class", "rating-container");
					container.setAttribute("id", numberOfRatings);
					container.innerHTML = `<p id="rating-${numberOfRatings}" onclick="editTitle(${numberOfRatings})" style="color: #dd9787">click to edit title</p><p><i onclick="setRating(${
						numberOfRatings * 5
					})" id="s${numberOfRatings * 5}" class="fa-regular fa-star"></i>&nbsp;<i onclick="setRating(${numberOfRatings * 5 + 1})" id="s${
						numberOfRatings * 5 + 1
					}" class="fa-regular fa-star"></i>&nbsp;<i onclick="setRating(${numberOfRatings * 5 + 2})" id="s${
						numberOfRatings * 5 + 2
					}" class="fa-regular fa-star"></i>&nbsp;<i onclick="setRating(${numberOfRatings * 5 + 3})" id="s${
						numberOfRatings * 5 + 3
					}" class="fa-regular fa-star"></i>&nbsp;<i onclick="setRating(${numberOfRatings * 5 + 4})" id="s${
						numberOfRatings * 5 + 4
					}" class="fa-regular fa-star"></i></p>`;
					body.insertBefore(container, end);

					numberOfRatings++;
				}
			}

			addRating();

			function removeRating() {
				if (numberOfRatings >= 0 && editing != numberOfRatings - 1) {
					numberOfRatings--;

					document.getElementById(numberOfRatings).remove();
				}
			}

			document.getElementById("button-plus").addEventListener("click", (e) => {
				addRating();
			});

			document.getElementById("button-minus").addEventListener("click", (e) => {
				removeRating();
			});

			function editTitle(rating) {
				pEditing = editing;
				//console.log(rating, pEditing);
				if (rating == pEditing) return;
				//console.log(string, pText, editing, justEscaped);

				if (editing != -1) {
					if (!justEscaped) {
						//let string = textArray.join("");
						string = document.inputForm.inputBox.value;
						if (string != "") {
							document.getElementById(`rating-${pEditing}`).innerHTML = string;
						} else {
							document.getElementById(`rating-${pEditing}`).innerHTML = pText;
							if (pText == "click to edit title") {
								document.getElementById(`rating-${pEditing}`).style = "color: #dd9787";
							}
						}
					}

					editing = -1;
					//textArray = [];
					justEscaped = false;
				}

				pText = document.getElementById(`rating-${rating}`).innerHTML;
				document.getElementById(`rating-${rating}`).style = "";
				document.getElementById(`rating-${rating}`).innerHTML = "<span>&nbsp;</span>";
				editing = rating;

				// console.log(editing * (46 + 25) + 50);
				// document.getElementById("inputForm").style = `top: ${editing * (46 + 25) + 50}px`;

				document.inputForm.inputBox.value = "";
				document.inputForm.inputBox.focus();
			}

			document.addEventListener("keydown", (e) => {
				keys[e.key] = true;

				if (keys["Shift"] === true && e.key === "Enter") {
					addRating();
					return;
				}

				if (keys["Shift"] === true && e.key === "Backspace") {
					removeRating();
					return;
				}

				if (editing == -1 || justEscaped) {
					if (e.key === "f") {
						if (document.fullscreenElement) {
							document.exitFullscreen();
						} else {
							document.documentElement.requestFullscreen();
						}
						return;
					}

					if (e.key === "Escape") {
						if (document.fullscreenElement) {
							document.exitFullscreen();
						}
						return;
					}
				}

				if (editing == -1) return;

				if (e.key === "Enter") {
					//let string = textArray.join("");

					string = document.inputForm.inputBox.value;
					//console.log(string);
					if (string != "") {
						document.getElementById(`rating-${editing}`).innerHTML = string;
					} else {
						document.getElementById(`rating-${editing}`).innerHTML = "click to edit title";
						document.getElementById(`rating-${editing}`).style = "color: #dd9787";
					}

					editing = -1;
					//textArray = [];
					document.activeElement.blur();
				}

				if (e.key === "Escape") {
					if (pText == "click to edit title") {
						document.getElementById(`rating-${editing}`).style = "color: #dd9787";
					}
					document.getElementById(`rating-${editing}`).innerHTML = pText;
					justEscaped = true;
					document.activeElement.blur();
				}

				// if (e.key === "Backspace") {
				// 	// textArray.pop();
				// 	// let string = textArray.join("");
				// 	//document.getElementById(`rating-${editing}`).innerHTML = string + "<span>&nbsp;</span>";
				// 	//document.inputForm.inputBox.value = string;
				// }

				// if ((e.keyCode >= 65 && e.keyCode <= 90) || (e.keyCode >= 48 && e.keyCode <= 57) || allowedKeys.includes(e.key)) {
				// 	if (document.getElementById(`rating-${editing}`).offsetWidth < 400) {
				// 		textArray.push(e.key);
				// 		let string = textArray.join("");
				// 		document.getElementById(`rating-${editing}`).innerHTML = string + "<span>&nbsp;</span>";
				// 	}
				// }
			});

			document.getElementById("inputForm").addEventListener("submit", (e) => {
				e.preventDefault();
			});

			document.inputForm.inputBox.addEventListener("input", (e) => {
				if (editing != -1) {
					//console.log("input");
					string = document.inputForm.inputBox.value;
					//console.log(pString, pString.length, string, string.length);

					if (document.getElementById(`rating-${editing}`).offsetWidth < 400) {
						// textArray.push(e.key);
						// let string = textArray.join("");

						document.getElementById(`rating-${editing}`).innerHTML = string + "<span>&nbsp;</span>";
						lastGoodString = string;
					} else {
						console.log(pString.length > string.length);
						if (pString.length > string.length) {
							document.getElementById(`rating-${editing}`).innerHTML = string + "<span>&nbsp;</span>";
							//console.log("less than");
						} else {
							document.inputForm.inputBox.value = lastGoodString;
							//console.log("greater than");
						}
					}

					pString = string;
				}
			});

			document.addEventListener("keyup", (e) => {
				delete keys[e.key];
			});

			function setRating(star) {
				for (let i = star - (star % 5); i < star - (star % 5) + 5; i++) {
					if (i <= star) {
						document.getElementById(`s${i}`).classList.remove("fa-regular");
						document.getElementById(`s${i}`).classList.add("fa-solid");
					} else {
						document.getElementById(`s${i}`).classList.remove("fa-solid");
						document.getElementById(`s${i}`).classList.add("fa-regular");
					}
				}
			}

			document.addEventListener("click", (e) => {
				//console.log("click event", e.target, editing, pEditing);
				if (editing != -1 && !justEscaped) {
					//console.log("focus allowed");
					document.inputForm.inputBox.focus();
				}
				//console.log(e.y);
				//document.getElementById("inputForm").style = `top: ${e.y - 80}px`;
			});

			// --- import and export shared ratings

			function importRatings() {
				const query = window.location.search;
				const item = new URLSearchParams(query);

				item.forEach((data) => {
					console.log(data);
				});
			}

			importRatings();

			function shareRatings() {
				console.log(false);
			}
		</script>
	</body>
</html>
